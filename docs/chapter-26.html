<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insight App - Chapter 26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Tinos:wght@700&display=swap');
        
        body {
            background-color: #007BFF; /* ビビットなブルー */
            font-family: 'Noto Sans JP', sans-serif;
        }

        /* 英語フォントをTimes New Romanに設定 */
        .font-english {
            font-family: 'Tinos', 'Times New Roman', serif;
            font-weight: 700;
            font-size: 1.25rem; /* 20px */
            line-height: 1.75rem; /* 28px */
        }

        .answer-span {
            color: #DC2626; /* 赤色 */
            font-weight: 700;
            display: none;
        }

        .underline-span {
            text-decoration: underline;
            text-underline-offset: 4px;
            display: inline;
        }

        .show-answer .answer-span {
            display: inline;
        }

        .show-answer .underline-span {
            display: none;
        }
        
        .explanation {
            display: none;
            white-space: pre-wrap;
        }

        /* Button Styles for Modal */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8 bg-blue-500 p-4 rounded-xl shadow-lg">
            <h1 class="text-2xl md:text-3xl font-bold text-white">Insight 英文法・語法・熟語</h1>
            <h2 id="app-subtitle" class="text-xl md:text-2xl font-bold text-white">学習用サイト（Chapter 26）</h2>
        </header>

        <main class="bg-white/90 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-28">
            <div class="flex justify-between items-center mb-6">
                 <!-- PDF Control Section -->
                 <div class="flex-1 mr-4">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="font-bold text-sm md:text-base mb-2">選択した問題でPDFを作成</h3>
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="select-all-checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <label for="select-all-checkbox" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">すべて選択 / 解除</label>
                            </div>
                            <button id="open-pdf-modal-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow text-sm transition-transform transform hover:scale-105">
                                PDF作成メニュー
                            </button>
                        </div>
                    </div>
                </div>

                <button id="start-quiz-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105 whitespace-nowrap">
                    ランダムテスト
                </button>
            </div>

            <div id="sentence-list" class="space-y-6">
                <!-- Sentences will be populated by JS -->
            </div>
        </main>
    </div>

    <!-- Control Panel -->
    <div id="control-panel" class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md p-4 border-t-2 border-gray-200 shadow-2xl flex justify-center items-center space-x-2 md:space-x-4">
        <button id="toggle-answer-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">表示/非表示</button>
        <button id="play-sound-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">音声再生</button>
        <button id="record-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">録音評価</button>
        <button id="toggle-explanation-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">解説</button>
    </div>

    <!-- Message/Score Modal -->
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div id="message-content" class="bg-white p-8 rounded-lg shadow-xl text-center">
            <!-- Message content will be populated by JS -->
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div id="quiz-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-40 p-4">
        <div class="bg-white w-full max-w-2xl p-8 rounded-2xl shadow-2xl relative">
            <button id="close-quiz-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold">&times;</button>
            <div id="quiz-content">
                <!-- Quiz content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- PDF Download Modal -->
    <div id="pdf-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">ダウンロードするPDFの種類を選択</h3>
                <div class="mt-2 space-y-3">
                    <button id="download-list-btn" class="btn btn-primary w-full justify-start text-left">1. 完全なリスト (熟語・意味・例文)</button>
                    <button id="download-en-quiz-btn" class="btn btn-primary w-full justify-start text-left">2. 熟語テスト (英語を解答)</button>
                    <button id="download-ja-quiz-btn" class="btn btn-primary w-full justify-start text-left">3. 熟語テスト (意味を解答)</button>
                    <button id="download-mixed-quiz-btn" class="btn btn-primary w-full justify-start text-left">4. 熟語テスト (混合)</button>
                    <button id="download-sentence-quiz-btn" class="btn btn-primary w-full justify-start text-left">5. 例文の穴埋め問題</button>
                    <button id="download-sentence-mixed-quiz-btn" class="btn btn-primary w-full justify-start text-left">6. 例文の混合問題 (穴埋め/和訳)</button>
                </div>
                <div class="mt-6">
                    <button id="close-modal-btn" class="btn btn-secondary w-full">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chapterData = [
    {
        "id": "1246",
        "ja": "ちょうど今，忙しいんです。後で話せますか。",
        "answer": "right now",
        "en": "I’m busy {right now}. Can we talk later?",
        "explanation": "right now  ͙͢ʢ＝immediatelyʣʯ\nby now͸ʯ\nuntil now ＝up to now·Ͱʯ➡20"
    },
    {
        "id": "1247",
        "ja": "「すぐに来 て く れ ま す か 。」「 了 解 ！ 」",
        "answer": "right away",
        "en": "“Can you come {right away}?” “Sure!”",
        "explanation": "right away ʮ͙͢ʹʯ\n＝immediately ＝instantly"
    },
    {
        "id": "1248",
        "ja": "⇧ 「一度 （once）の 時 点 で（at） ⭢ 同時に」 「すると決めた時と同時に ⭢ すぐに」",
        "answer": "at once",
        "en": "I have to leave {at once} to catch the bus.",
        "explanation": "at once  ᶃʮ ͢ ͙ ʹʢ＝immediatelyʹ ʢ＝at the same timeʣʯ\n⇧ 「一度 （once）の 時 点 で（at） ⭢ 同時に」 「すると決めた時と同時に ⭢ すぐに」\nall at once  ᶃʮ ಥ વʢ＝suddenlyʣʯ ᶄʮ ͍ ͬ ͤ ͍ ʹ ʯ"
    },
    {
        "id": "1249",
        "ja": "⇧ 「一度 （once）の 時 点 で（at） ⭢ 同時に」 「すると決めた時と同時に ⭢ すぐに」 発展 私はその場でチームに加わることを決めた。",
        "answer": "on the spot",
        "en": "I decided to join the team {on the spot}.",
        "explanation": "on the spotʹʢ＝immediatelyʣʯ\n⇧「 そ の 場 所（the spot）で（on）」\njoinͳͲʣͷҰһͱͳΔʯ"
    },
    {
        "id": "1250",
        "ja": "⇧「 そ の 場 所（the spot）で（on）」",
        "answer": "in a minute",
        "en": "I’ll be with you {in a minute}.",
        "explanation": "in a minute\nin no time       ʮ͙͢ʹʯ＝very soon ＝in a moment ＝in a second\n⇧ 「一瞬の （a minute） ／時間がない （no time）う ち に（in）」"
    },
    {
        "id": "1251",
        "ja": "⇧ 「一瞬の （a minute） ／時間がない （no time）う ち に（in）」 その法律はまもなく可決されるだろう。",
        "answer": "before long",
        "en": "That law will be passed {before long}.",
        "explanation": "before long ʮ·΋ͳ͘ʯ＝soon\n⇧「 長 く（long）に な る 前 に（before）」"
    },
    {
        "id": "1252",
        "ja": "⇧「 長 く（long）に な る 前 に（before）」 現在，社会保障費の増加が大きな問題となっ ている。",
        "answer": "At present",
        "en": "{At present}, the increase in social security costs is a big problem.",
        "explanation": "at presentͷͱ͜Ζ͸ʯ＝currently\n⇧「 現 在（present）の 時 点 で（at）」\nfor the presentɼ͠͹Β͘͸ʯ＝for the time being  ➡1255\nsocial security costsձอোඅʯ"
    },
    {
        "id": "1253",
        "ja": "⇧「 現 在（present）の 時 点 で（at）」 昔は，今よりもっとビニール袋を使っていた。",
        "answer": "In the past",
        "en": "{In the past}, we used more plastic bags than we do today.",
        "explanation": "in the pastʹʯ\na plastic bag ʮϏχʔϧାʯ"
    },
    {
        "id": "1254",
        "ja": "ネットショッピングのこうした流行は今後も続くだろう。",
        "answer": "in the future",
        "en": "This trend of online shopping will continue {in the future}.",
        "explanation": "in the future͸ʯ\nin the near future͍কདྷʯ\ntrendʯ"
    },
    {
        "id": "1255",
        "ja": "発展 この話題はしばらく置 いておこう。",
        "answer": "for the time being",
        "en": "Let’s put this topic aside {for the time being}.",
        "explanation": "for the time being\nfor the present          ɼ͠͹Β͘͸ʯ\n⇧「 今 こ の 時（the time）が 存 在 す る（being）間（for）は 」\nat presentͷͱ͜Ζ͸ʯ＝currently  ➡1252\nput aside A / put A aside  ᶃʮA Λऔ͓ͬͯ͘ʯ ᶄʮAʢ໰୊ͳͲʣΛอཹʹ͢Δʯ"
    },
    {
        "id": "1256",
        "ja": "⇧「 今 こ の 時（the time）が 存 在 す る（being）間（for）は 」 ナオミはどうしていますか 。しばらく彼女に会っていないけれど。",
        "answer": "for a while",
        "en": "How’s Naomi? I haven’t seen her {for a while}.",
        "explanation": "for a whileʯ\n⇧「 し ば ら く（a while）の 間（for）」"
    },
    {
        "id": "1257",
        "ja": "⇧「 し ば ら く（a while）の 間（for）」",
        "answer": "After a while",
        "en": "{After a while}, I felt much better.",
        "explanation": "after a while ʮ͠͹Βͯ͘͠ʯ\n⇧「 し ば ら く（a while）し た 後（after）」\nfeel much better෼͕͍ͣͿΜྑ͘ͳΔʯ"
    },
    {
        "id": "1258",
        "ja": "⇧「 し ば ら く（a while）し た 後（after）」",
        "answer": "for ages",
        "en": "I haven’t been to the beach {for ages}.",
        "explanation": "for agesʯ＝for a long time\n⇧ 「長期間 （ages）の 間（for）」\nfor years ʮԿ೥΋ʯ"
    },
    {
        "id": "1259",
        "ja": "⇧ 「長期間 （ages）の 間（for）」",
        "answer": "for good",
        "en": "My father said he quit smoking {for good}.",
        "explanation": "for goodʹʯ＝forever ＝permanently\n▶ イギリスではfor good and allも同じ意味で使われる。"
    },
    {
        "id": "1260",
        "ja": "▶ イギリスではfor good and allも同じ意味で使われる。 発展 私たちはこの問題についてきっぱりと決着をつける必要がある。",
        "answer": "once and for all",
        "en": "We need to settle this matter {once and for all}.",
        "explanation": "once and for allʹɼ͖ͬͺΓͱʯ\n⇧「 一 度（once）そし て（and）そ れ が 全 部 の 代 わ り（for all）」\nsettle͢Δʢ＝resolveʣʯ"
    },
    {
        "id": "1261",
        "ja": "⇧「 一 度（once）そし て（and）そ れ が 全 部 の 代 わ り（for all）」",
        "answer": "all along",
        "en": "I realized that my keys were in the bag {all along}.",
        "explanation": "all along ʮͣͬͱʢ＝all the time)ɼ ॳ Ί ͔ Βʢ＝from the beginningʣʯ\n⇧「 全 部（all）に 沿 っ て（along）」"
    },
    {
        "id": "1262",
        "ja": "⇧「 全 部（all）に 沿 っ て（along）」 これまでに，5 人の生徒がこのプロジェクトに集まった。",
        "answer": "So far",
        "en": "{So far}, five students have come together for this project.",
        "explanation": "so far·Ͱͷͱ͜Ζɼ͜Ε·Ͱʹʯ＝until now ＝up to now\n▶ so far / until now / up to now は現在完了形と共に使うことが多い。\n⇔ from now on͸ʯ\ncome together ʮʢάϧ ʔϓͱͯ͠ʣू·Δʯ"
    },
    {
        "id": "1263",
        "ja": "▶ so far / until now / up to now は現在完了形と共に使うことが多い。 発展 これまでのところ，その行方不明の旅行者に関する情報はない。",
        "answer": "As yet",
        "en": "{As yet}, there is no information about the missing tourist.",
        "explanation": "as yetͷͱ͜Ζʢʙͳ͍ʣʯ\n否定文や否定語と共に使うことが多い。\nA …, (and) yet B …ʮA …͕ͩB …ɼA …͔͠͠B …ʯ➡846-3\nmissingํෆ໌ͷʯ"
    },
    {
        "id": "1265",
        "ja": "発展 誰でもたまには間違いをする。 ⇧「 し ば らくの 間（a while）の 中 で（in）一 度（once）」 発展 今日は一日中，雨が降ったりやんだりしている。",
        "answer": "on and oﬀ",
        "en": "It’s been raining {on and oﬀ} all day today.",
        "explanation": "on and off\noff and on    ʮஅଓతʹʯ\n⇧「 付 い て（on）そし て（and）離 れ て（off）」\nall day (long)ʮҰ೔தʯ⇔⇔ all night (long)ʮҰ൩தʯ\n▼1266～1267ʫ\n1266-1\n基本\n一般的に，日本の夏は蒸し暑い。\n(I      ) (        ), summers in Japan are hot and humid.\nTip  ͸ ʁ ͸ ʁ\n1266-1 In general, summers in Japan are hot and humid.\nin general             ᶃ ʮҰൠతʹʢ＝generallyʣʯ\nas a whole            ᶄ ʮશମͱ͠ ͯʢ＝all in allʣʯ\non the whole    ᶅ ʮʙશମʢ＝ ～ at largeʣʯ\nhot and humid ʮৠ͠ॵ͍ʯ―humidͷ͋Δʯ\n1266-2 全 体として，試験はうまくいった。\n(O      ) (        ) (        ), I did well in my exams.\nTip  ͸ ʁ ͸ ʁ\n1266-2 On the whole, I did well in my exams.\n▶ on the whole 「一般的に，全体と して，～全体」➡1266-1\ndo well ʮ͏·͘΍Δʯ＝succeed\n1267-1 たいてい，私はバスで学校に行くが，時々歩く こ ともある。\n(A      ) (        ) (        ), I take the bus to school, but sometimes I walk.\nTip   usuallyusually͸ ʁ͸ ʁ\n1267-1 As a rule, I take the bus to school, but sometimes I walk.\nas a (general) rule\n͠ ͯɼҰൠతʹʢ＝generallyʣʯ ᶄʮ ͨ ͍ ͯ ͍ʢ＝usuallyʣʯ\n⇧ 「一般的な （general）規 則（a rule）とし て（as）」\n1267-2 一般的に，日本の６月は雨が多い。\n(B      ) (        ) (        ), it rains a lot in June in Japan.\nTip   generallygenerally͸ ʁ͸ ʁ\n1267-2 By and large, it rains a lot in June in Japan.\nby and large͠ ͯɼҰൠతʹʯ\n⇧「 近 く（by）も（and）幅 広 く（large）も 」\n＝generally ＝as a (general) rule\nit rains a lotΔʯ\n⇔⇔ it doesn’t rain muchΒͳ͍ʯ"
    },
    {
        "id": "1268",
        "ja": "そのショッピングモールで偶然，昔の友達に会った。",
        "answer": "by chance",
        "en": "I met my old friend {by chance} at the mall.",
        "explanation": "▶ by は前置詞で「～によって，～経由で，～単位で，～のそばに」などの意味。\nby chance\nby accident    વʹʯ＝accidentally\nchance, accident には「偶然」という意味がある。"
    },
    {
        "id": "1269",
        "ja": "▶ by は前置詞で「～によって，～経由で，～単位で，～のそばに」などの意味。 chance, accident には「偶然」という意味がある。 発展 「ひょっとして， ハ リ ス さ ん で す か 。」「 は い ， 私 で す 。」",
        "answer": "by any chance",
        "en": "“Are you Ms. Harris, {by any chance}?” “Yes, I am.”",
        "explanation": "by any chance ʮ ͻΐͬͱͯ͠ʢʙ͔ʣʯ＝perhaps\n⇧「 少 し の（any）偶 然（chance）に よっ て（by）」\n疑問文で使う。"
    },
    {
        "id": "1270",
        "ja": "⇧「 少 し の（any）偶 然（chance）に よっ て（by）」 疑問文で使う。 重 要なファイルを誤って削 除してしまった 。どうにかして元 に戻 せません か 。",
        "answer": "by mistake",
        "en": "I’ve deleted an important file {by mistake}. Can I recover it somehow?",
        "explanation": "by mistakeҧͬͯʯ＝mistakenly ＝accidentally\n⇧「 誤 り（mistake）に よっ て（by）」\nmake a mistakeҧ͍Λ͢Δʯ\ndeleteআ͢Δʯ―パソコンのデリートキーは「削除キー」のこと。\nrecover ʮճ෮͢ΔɼʙΛऔΓ໭͢ʯ"
    },
    {
        "id": "1271",
        "ja": "⇧「 誤 り（mistake）に よっ て（by）」 deleteআ͢Δʯ―パソコンのデリートキーは「削除キー」のこと。",
        "answer": "by hand",
        "en": "These wooden bowls are crafted {by hand}.",
        "explanation": "by hand ʮਓͷखͰʯ⇦「 人 の 手（hand）に よっ て（by）」\nwooden bowl ʮ໦੡ͷ࿶ʯ\ncraft  Δʯ"
    },
    {
        "id": "1272",
        "ja": "by hand ʮਓͷखͰʯ⇦「 人 の 手（hand）に よっ て（by）」",
        "answer": "by nature",
        "en": "Cats are independent {by nature}.",
        "explanation": "by nature ʮੜ·Ε͖ͭʯ＝naturally\n⇧「 天 性（nature）に よっ て（by）」"
    },
    {
        "id": "1273",
        "ja": "⇧「 天 性（nature）に よっ て（by）」",
        "answer": "by birth",
        "en": "Mari is Japanese {by birth}, but has lived in France for a long time.",
        "explanation": "by birth ʮੜ·Ε͸ʯ\n⇧「 誕 生（birth）に よっ て（by）」\nfor a long timeʯ＝for ages"
    },
    {
        "id": "1274",
        "ja": "⇧「 誕 生（birth）に よっ て（by）」",
        "answer": "by sea than by air.",
        "en": "It is more environmentally friendly to ship goods {by sea than by air.}",
        "explanation": "by sea ʮւ࿏Ͱʯ⇦「 海（sea）を 経 由 し て（by）」\nby air࿏Ͱʯ⇦ 「大気 （air）を 経 由 し て（by）」\nby land ʮ཮࿏Ͱʯ\nenvironmentally friendlyʹ༏͍͠ʯ＝eco-friendly\n⇔⇔ environmentally damagingഁյతͳʯ\nship  ɾτϥοΫͳͲͰʣʙΛ༌ૹ͢Δʯ"
    },
    {
        "id": "1275",
        "ja": "by sea ʮւ࿏Ͱʯ⇦「 海（sea）を 経 由 し て（by）」 by air࿏Ͱʯ⇦ 「大気 （air）を 経 由 し て（by）」",
        "answer": "By degrees",
        "en": "{By degrees}, our friendship grew stronger.",
        "explanation": "by degreesୈʹʯ＝gradually\n⇧ 「度合い （degrees）の 単 位 で（by）」\ndegreeҐʯ\nfriendship ʮ༑৘ʯ"
    },
    {
        "id": "1276",
        "ja": "by all means ʮͥͻͱ΋ʯ―means「手段」は単数形も複数形もmeans。 ⇧「 あ ら ゆ る（all）手 段（means）を 使 っ て（by）で も 」",
        "answer": "By all means",
        "en": "{By all means}, please let us know what you think about the matter.",
        "explanation": "by all means ʮͥͻͱ΋ʯ―means「手段」は単数形も複数形もmeans。\n⇧「 あ ら ゆ る（all）手 段（means）を 使 っ て（by）で も 」\nby no meansͯ͠…Ͱ͸ͳ͍ʯ➡444"
    },
    {
        "id": "1277",
        "ja": "by all means ʮͥͻͱ΋ʯ―means「手段」は単数形も複数形もmeans。 ⇧「 あ ら ゆ る（all）手 段（means）を 使 っ て（by）で も 」 ところで，あの本はもう読んだ？",
        "answer": "By the way",
        "en": "{By the way}, have you read that book yet?",
        "explanation": "by the way ʮͱ͜ΖͰʯ\n⇧「 道（the way）の そ ば（by） ⭢ （脇道にそれるが）ところで」\nin the [one’s] wayʮʢ ʙ ͷ ʣअ ຐ ʹ ͳ ͬ ͯ ʯ\non the [one’s] way home୐్தͰʯ➡834-2\n▼ 1278～1283ʪatʫ"
    },
    {
        "id": "1278",
        "ja": "⇧「 道（the way）の そ ば（by） ⭢ （脇道にそれるが）ところで」 ついに，戦争が終わった。",
        "answer": "At last",
        "en": "{At last}, the war ended.",
        "explanation": "▶ at は時や場所を点 （時点・地点） ととらえて「～に，～で」を意味する前置詞。\nat last ʮ͍ͭʹɼ΍ͬͱʯ＝/f_inally\n⇧「 最 後（last）で（at）」"
    },
    {
        "id": "1279",
        "ja": "▶ at は時や場所を点 （時点・地点） ととらえて「～に，～で」を意味する前置詞。 ⇧「 最 後（last）で（at）」",
        "answer": "talked at length",
        "en": "He {talked at length} about his hobbies.",
        "explanation": "at length  ᶃʮ ௕ ʑͱ ʯ ᶄʮ Α͏ ΍ ͘ɼ ΍ ͬͱʢ＝/f_inally ＝at lastʣʯ\n⇧「 長 さ（length）を か け た 状 態 で（at）」"
    },
    {
        "id": "1280",
        "ja": "⇧「 長 さ（length）を か け た 状 態 で（at）」 最初は，彼らの英語についていけなかったが，次第に彼らが何を言っているのか 理解できるようになった。",
        "answer": "At /f_irst",
        "en": "{At /f_irst}, I could not follow their English, but gradually I began to",
        "explanation": "understand what they were saying.\nat /f_irstॳ͸ɼॳΊͷ͏ͪ͸ʯ⇦ 「最初の （first）時 点 に お い て は（at）」\n▶ 順序ではなく時点を表す。後にbut や however を 含 む 文 が き て ，「 し か し そ う\nではなかった」という内容が続く ことが多い。\n/f_irst of all ʮ·ͣॳΊʹɼୈҰʹʯ＝/f_irst ＝/f_irstly ― 順序を表す。➡1311-1\nfor the /f_irst time ʮॳΊͯʢʙ͢Δʣʯ\ngradually ʮঃʑʹʯ⇔⇔ suddenlyʮಥવʹʯ"
    },
    {
        "id": "1281",
        "ja": "at /f_irstॳ͸ɼॳΊͷ͏ͪ͸ʯ⇦ 「最初の （first）時 点 に お い て は（at）」 ▶ 順序ではなく時点を表す。後にbut や however を 含 む 文 が き て ，「 し か し そ う ではなかった」という内容が続く ことが多い。 /f_irst of all ʮ·ͣॳΊʹɼୈҰʹʯ＝/f_irst ＝/f_irstly ― 順序を表す。➡1311-1",
        "answer": "/f_irst hand",
        "en": "I hope to see the Eiffel Tower {/f_irst hand}.",
        "explanation": "(at) /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly\n⇧ 「 （間接的ではなく） 直接最初に （first）手（hand）を 触 れ て（at）」\n⇔ (at) second hand઀తʹɼਓΛհͯ͠ʯ\n▶ Eiffel の発音に注意。/áif6l/\nclose at hand  ͘ʹʯᶅ ʮ΋͏͙͢ʯ➡1305-1"
    },
    {
        "id": "1282",
        "ja": "⇧ 「 （間接的ではなく） 直接最初に （first）手（hand）を 触 れ て（at）」 ▶ Eiffel の発音に注意。/áif6l/",
        "answer": "at will",
        "en": "The cat comes and goes {at will}.",
        "explanation": "at will͍ͷ··ʹʯ\n⇧「 自 由 な 意 志（will）で（at）」"
    },
    {
        "id": "1283",
        "ja": "⇧「 自 由 な 意 志（will）で（at）」",
        "answer": "at all costs",
        "en": "We must avoid war {at all costs}.",
        "explanation": "at all costs\nat any cost    ਜ਼Λ෷ͬͯ΋ʯ\n⇧「 す べ て の（all）／ ど ん な（any）犠 牲（costs/cost）で も（at）」\navoid ʮʙΛආ͚Δʯ"
    },
    {
        "id": "1284",
        "ja": "▶ このon は前置詞で「～において」の意味を表す。 ⇧「 目 的 や 意 図（purpose）に お い て（on）」 perhaps ʮ΋͔͢͠Δͱʯ―probablyʮ͓ͦΒ͘ʯよ り確信度は低い。",
        "answer": "on purpose",
        "en": "Perhaps she didn’t attend the meeting {on purpose}.",
        "explanation": "▶ このon は前置詞で「～において」の意味を表す。\non purposeҙʹʯ＝intentionally ＝deliberately\n⇧「 目 的 や 意 図（purpose）に お い て（on）」\nfor the purpose of doing ʮʙ͢Δ໨తͰʯ＝with a view to doing  ➡1334\nperhaps ʮ΋͔͢͠Δͱʯ―probablyʮ͓ͦΒ͘ʯよ り確信度は低い。"
    },
    {
        "id": "1285",
        "ja": "▶ このon は前置詞で「～において」の意味を表す。 ⇧「 目 的 や 意 図（purpose）に お い て（on）」 perhaps ʮ΋͔͢͠Δͱʯ―probablyʮ͓ͦΒ͘ʯよ り確信度は低い。 発展 考え 直して，ピザを注文しようと思う。",
        "answer": "On second thought(s)",
        "en": "{On second thought(s)}, I think I’ll order the pizza.",
        "explanation": "on second thought (s)͑௚ͯ͠ʯ\n⇧「２回 め の（second）考 え（thought）に お い て（on）」"
    },
    {
        "id": "1286",
        "ja": "⇧「２回 め の（second）考 え（thought）に お い て（on）」",
        "answer": "on short notice",
        "en": "The event was canceled {on short notice}.",
        "explanation": "on [at] short notice͖ΐʯ\n⇧「 短 い（short）通 知（notice）で（on/at）」\n▶ on short notice はアメリカで，at short notice はイギリスで使われる。\nbe canceledʹͳΔʯ\n▼ 1287～1296ʪinʫ"
    },
    {
        "id": "1287",
        "ja": "⇧「 短 い（short）通 知（notice）で（on/at）」 ▶ on short notice はアメリカで，at short notice はイギリスで使われる。 実は，人前で話すのは好きではありません。緊張し てしまいます。",
        "answer": "in public",
        "en": "Actually, I don’t like speaking {in public}. It makes me nervous.",
        "explanation": "▶ このin は前置詞で， 「～の中で」などの意味を表す。\nin publicવͱʯ⇦ 「公衆 （public）の 中 で（in）」\n⇔ in privateʮ಺ີʹʯ⇦ 「 プ ラ イ ベ ー ト（private）の 中 で（in）」\n“Can we talk about this in private?” “Yes, of course.”\n「この件について内密に話 せ ま す か 。」「 え え ， も ち ろ ん 。」"
    },
    {
        "id": "1288",
        "ja": "▶ このin は前置詞で， 「～の中で」などの意味を表す。 in publicવͱʯ⇦ 「公衆 （public）の 中 で（in）」 ⇔ in privateʮ಺ີʹʯ⇦ 「 プ ラ イ ベ ー ト（private）の 中 で（in）」 「この件について内密に話 せ ま す か 。」「 え え ， も ち ろ ん 。」",
        "answer": "in more detail",
        "en": "Could you explain it {in more detail}?",
        "explanation": "in detail ʮৄ͘͠ʯ\n⇧「 詳 細（detail）の 中 で（in）」"
    },
    {
        "id": "1289",
        "ja": "⇧「 詳 細（detail）の 中 で（in）」",
        "answer": "in advance",
        "en": "Please let me know {in advance} if you can come.",
        "explanation": "in advanceલʹɼ͋Β͔͡Ίʯ＝beforehand\n⇧「 前 進（advance）の 中 で（in）」"
    },
    {
        "id": "1290",
        "ja": "⇧「 前 進（advance）の 中 で（in）」 各生徒が順番に質問に答えた。",
        "answer": "in turn",
        "en": "Each student answered the question {in turn}.",
        "explanation": "in turn  ౓͸ʯ\n▶ このturn は名詞で「順番」の意味。\ntake turns (in) doing୅Ͱʙ͢Δɼॱ൪ʹʙ͢Δʯ➡693"
    },
    {
        "id": "1291",
        "ja": "▶ このturn は名詞で「順番」の意味。",
        "answer": "in person",
        "en": "I prefer to talk to her {in person}.",
        "explanation": "in personΒʯ\n⇧「 個 人（person）に お い て（in）」\nprefer to doΉʯ\ntalk to A / talk with A ʮA ͱ࿩͢ʯ"
    },
    {
        "id": "1292",
        "ja": "⇧「 あ る（a）意 味（sense）の 中 で は（in）」",
        "answer": "in a sense",
        "en": "What he says is true, {in a sense}.",
        "explanation": "in a sense ʮ͋ΔҙຯͰ͸ʯ\n⇧「 あ る（a）意 味（sense）の 中 で は（in）」"
    },
    {
        "id": "1293",
        "ja": "⇧「 あ る（a）意 味（sense）の 中 で は（in）」",
        "answer": "in any case",
        "en": "Sara didn’t come, but {in any case}, we had a lot of fun.",
        "explanation": "in any case\nat any rate     ʮͱʹ͔͘ɼ͍ͣΕʹͤΑʯ\n⇧「 ど の ような（any）場 合（case） ／割合 （rate）の 中 で も（in）／ に お い て も（at）」\n＝anyway\nhave fun͠Ήʯ＝have a good time ＝enjoy oneself"
    },
    {
        "id": "1294",
        "ja": "⇧「 ど の ような（any）場 合（case） ／割合 （rate）の 中 で も（in）／ に お い て も（at）」",
        "answer": "just in case",
        "en": "Keep the receipt {just in case}.",
        "explanation": "just in case ʮສҰʹඋ͑ͯʯ\nin that caseʹ͸ʯ\nin case of A ʮAʹ͸ʯ\nin case …ʮ…ʹඋ͑ͯɼ…͢Δͱ͍͚ͳ͍͔Βʯ➡270\nreceipt ʮϨγʔτʯ―p は発音しない。"
    },
    {
        "id": "1295",
        "ja": "receipt ʮϨγʔτʯ―p は発音しない。 発展 ソーラーパネルの設置には費用がかかるが，長期的にはコスト削 減になる。",
        "answer": "Installing solar panels can be expensive, but they reduce costs",
        "en": "{Installing solar panels can be expensive, but they reduce costs}",
        "explanation": "in the long run.\nin the long runతʹ͸ʯ\n⇧「 長 い（long）連 続（run）に お い て（in）」\n⇔ in the short runతʹ͸ʯ\ninstall ʮʙΛઃஔ͢Δʯ⇔⇔ removeʮʙΛऔΓ֎͢ʯ\nreduce costs͢Δʯ"
    },
    {
        "id": "1296",
        "ja": "⇧「 長 い（long）連 続（run）に お い て（in）」",
        "answer": "In my opinion",
        "en": "{In my opinion}, racism can be eliminated through education.",
        "explanation": "in one’s opinionͰ͸ʯ\n⇧「 ～ の 意 見（oneʼs opinion）に お い て（in）」\nIn my view , …͑Ͱ͸…ʯ＝in my opinion\nracismʯ\neliminate ʮʙΛऔΓআ͘ʯ＝remove ＝get rid of"
    },
    {
        "id": "1297",
        "ja": "⇧「 ～ の 意 見（oneʼs opinion）に お い て（in）」",
        "answer": "from an ecological point of view",
        "en": "Protecting forests is crucial {from an ecological point of view}.",
        "explanation": "from ～ point of view஍ʧ ͔Β͢Ε͹ʯ\nFrom my point of view , …ղͰ͸…ʯ\nFrom the author ’s point of view, …ղʹΑΔͱ…ʯ\ncrucialఆతͳʯ\necologicalͷʯ"
    },
    {
        "id": "1298",
        "ja": "⇧「 あ る（some/a certain）程 度（extent/degree）ま で（to）」",
        "answer": "To some extent",
        "en": "{To some extent}, I understand what you’re saying.",
        "explanation": "to some extent [degree]\nto a certain extent [degree]    ʮ͋Δఔ౓·Ͱʯ\n⇧「 あ る（some/a certain）程 度（extent/degree）ま で（to）」"
    },
    {
        "id": "1299",
        "ja": "▶ 〈to oneʼs＋感情を表す名詞〉 で， 「～が…したことに」という意味になる。",
        "answer": "To my surprise",
        "en": "{To my surprise}, my brother cooked dinner for us tonight.",
        "explanation": "▶ 〈to oneʼs＋感情を表す名詞〉 で， 「～が…したことに」という意味になる。\nto one’s surprise͍ͨ͜ͱʹʯ"
    },
    {
        "id": "1300",
        "ja": "▶ 〈to oneʼs＋感情を表す名詞〉 で， 「～が…したことに」という意味になる。",
        "answer": "To my delight",
        "en": "{To my delight}, my family decided to adopt a new puppy.",
        "explanation": "to one’s delightΜͩ͜ͱʹʯ\nadoptʹ͢Δʯ"
    },
    {
        "id": "1301",
        "ja": "▶ much を付けると強調表現になる。Much to my relief「とても安心したことに」",
        "answer": "To our relief",
        "en": "{To our relief}, my sister found her lost smartphone under the bed.",
        "explanation": "to one’s reliefʮʙ͕҆৺ͨ͜͠ͱʹɼʙ͕΄ͬͱͨ͜͠ͱʹʯ\n▶ much を付けると強調表現になる。Much to my relief「とても安心したことに」"
    },
    {
        "id": "1302",
        "ja": "▶ much を付けると強調表現になる。Much to my relief「とても安心したことに」 言えない。",
        "answer": "for sure",
        "en": "No one can say {for sure} how technology will affect our jobs.",
        "explanation": "for sure\nfor certain    ͔ʹɼ͸͖ͬΓͱʯ＝surely ＝certainly\nto be sure͔ʹʢ…͕ͩʣʯ\nNo one can …ʮ୭΋…Ͱ͖ͳ͍ɼ…Ͱ͖Δऀ͸͍ͳ͍ʯ"
    },
    {
        "id": "1303",
        "ja": "大学の授業料を自分で払わなければならないかもしれない。",
        "answer": "on my own",
        "en": "I may have to pay for my college tuition {on my own}.",
        "explanation": "on one’s ownྗͰʯ＝(by) oneself\n⇧「 ～ 自 身（oneʼs own）に お い て（on）」\ntuitionඅʯ"
    },
    {
        "id": "1304",
        "ja": "⇧「 ～ 自 身（oneʼs own）に お い て（on）」",
        "answer": "at random",
        "en": "I picked a card {at random}.",
        "explanation": "at randomҝʹɼͰͨΒΊʹʯ\n1305-1 英語を勉強する時，私はいつも辞書を手元に置いておく。\nI always keep my dictionary (c      ) (        ) (        ) when I study\nEnglish.\nTip  ͸ ʁ ͸ ʁ\n1305-1 I always keep my dictionary close at hand when I study English.\nclose at hand\nnear at hand    తʹʣ΋͏͙͢ʯ\n⇧「 手（hand）の 近 く（close/near）に（at）」\n(at) /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly  ➡1281\n1305-2 すぐ近くにいいレストランがある。\nThere is a good restaurant (c      ) (        ) (        ).\nTip  ͸ ʁ ͸ ʁ\n1305-2 There is a good restaurant close at hand.\n▶ この問題文のclose at hand は「すぐ近くに」の意味。➡1305-1\nnearby͘ʹʯとほぼ同じ意味を表す。"
    },
    {
        "id": "1306",
        "ja": "1305-1 英語を勉強する時，私はいつも辞書を手元に置いておく。 ⇧「 手（hand）の 近 く（close/near）に（at）」 1305-2 すぐ近くにいいレストランがある。 ▶ この問題文のclose at hand は「すぐ近くに」の意味。➡1305-1 nearby͘ʹʯとほぼ同じ意味を表す。",
        "answer": "All of a sudden",
        "en": "{All of a sudden}, it began to rain heavily.",
        "explanation": "all of a sudden ʮಥવɼ͍͖ͳΓʯ\n＝suddenly ＝all at once"
    },
    {
        "id": "1307",
        "ja": "⇧「 少 し（little）の 差 で（by）ま た 少 し（little）」",
        "answer": "little by little",
        "en": "My English improved {little by little} during the homestay.",
        "explanation": "little by little ʮগͣͭ͠ɼঃʑʹʯ＝gradually ＝by degrees\n⇧「 少 し（little）の 差 で（by）ま た 少 し（little）」\none by one ʮ̍ͭͣͭʯ\nday by day ʮ೔ʹ೔ʹʯ"
    },
    {
        "id": "1308",
        "ja": "発展 夕食は家族全員で食べることが 多い。",
        "answer": "More often than not",
        "en": "{More often than not}, I eat dinner with the whole family.",
        "explanation": "more often than not ʮ͍͍ͨͯʯ＝usually\nthe whole family ʮՈ଒શһʯ"
    },
    {
        "id": "1309",
        "ja": "⇧「 内 側（inside）が 外（out）」",
        "answer": "inside out",
        "en": "You might be wearing your sweater {inside out}.",
        "explanation": "inside out ʮཪฦ͠ʹʯ\n⇧「 内 側（inside）が 外（out）」"
    },
    {
        "id": "1310",
        "ja": "⇧「 内 側（inside）が 外（out）」",
        "answer": "upside down",
        "en": "A glass is {upside down} on the table.",
        "explanation": "upside down͞·ʹʯ\n⇧「 上 側（upside） が下方向 （down）」\n1311-1\n基本\nまず第一に，教育の重要性を強調したいと思います。\n(F      ) (        ) (        ), I would like to emphasize the importance of\neducation.\nTip  ͸ ʁ ͸ ʁ\n1311-1 First of all, I would like to emphasize the importance of education.\n/f_irst of all ʮ·ͣॳΊʹɼୈҰʹʯ＝/f_irst ＝/f_irstly ＝to begin with\n⇧「 す べ て（all）の 中 の（of）最 初（first） 」―順序を表す。\nat /f_irst ʮॳΊͷ͏ͪ͸ʯ― 時点を表す。➡1280\nemphasizeௐ͢Δʯ\n1311-2 初めに，この図をご覧ください。\n(T      ) (        ) (        ), please take a look at this chart.\nTip  ͸ ʁ ͸ ʁ\n1311-2 To begin with, please take a look at this chart.\nto begin with\nto start with      ʮॳΊʹʯ＝/f_irst ＝/f_irstly ＝/f_irst of all\n⇧「 ～ に つ い て（with）始 め る（begin/start）た め に（to）」"
    },
    {
        "id": "1312",
        "ja": "⇧「 上 側（upside） が下方向 （down）」 基本 まず第一に，教育の重要性を強調したいと思います。 ⇧「 す べ て（all）の 中 の（of）最 初（first） 」―順序を表す。 at /f_irst ʮॳΊͷ͏ͪ͸ʯ― 時点を表す。➡1280 1311-2 初めに，この図をご覧ください。 ⇧「 ～ に つ い て（with）始 め る（begin/start）た め に（to）」 人々は環境を守るために対策を講じている。例えば，ごみを分別している。",
        "answer": "For example",
        "en": "People are taking steps to protect the environment. {For example},",
        "explanation": "they separate their garbage.\nfor example\nfor instance    ʮྫ͑͹ʯ⇦「 例（example） ／事例 （instance）とし て（for）」\ntake steps͡Δʯ\nprotect the environmentΛकΔʯ\nseparate garbage ʮ͝ΈΛ෼ผ͢Δʯ"
    },
    {
        "id": "1313",
        "ja": "for instance    ʮྫ͑͹ʯ⇦「 例（example） ／事例 （instance）とし て（for）」",
        "answer": "as follows",
        "en": "The results of the survey are {as follows}:",
        "explanation": "as followsͷ௨ΓɼҎԼͷ௨Γʯ⇦ 「 後 に 続 く（follows）よう に（as）」\nsurveyʯ\n1314-1\n基本\nナオミは英語が流ちょうだ。加えて，フランス語も話せる。\nNaomi is fluent in English. (I      ) (        ), she can speak French.\nTip   moreovermoreover͸ ʁ͸ ʁ\n1314-1 Naomi is fluent in English. In addition, she can speak French.\nin addition ʮՃ͑ͯʯ＝moreover ＝furthermore ＝what’s more\n⇧ 「追加(addition) に お い て（in）」\nbe /f_luent in A ʮA ʣ͕ ྲྀͪΐ͏ͩʯ\n1314-2\n基本\n私は英語以外の別の言語も学びたい。\nI would like to learn another language (i      ) (        ) (        ) (E      ).\nTip  ͢Δɻ ͢Δɻ\n1314-2\n＝\nI would like to learn another language in addition to English.\nI would like to learn another language besides English.\nin addition to A ʮA ʹՃ͑ͯʯ＝besides A\n⇧「A に（to）加 え て（in addition）」"
    },
    {
        "id": "1315",
        "ja": "私は読書が好きだ。特に東野圭吾のミステリー小説を読むのが。",
        "answer": "in particular",
        "en": "I like reading, {in particular}, mystery novels by Higashino Keigo.",
        "explanation": "in particularʮಛʹʯ⇦ 「 特 定 の（particular）範 囲 内 で（in）」＝particularly\nbe particular about A ʮAΈͳͲ͕ʣ͏Δ͍͞ʯ➡898"
    },
    {
        "id": "1316",
        "ja": "in particularʮಛʹʯ⇦ 「 特 定 の（particular）範 囲 内 で（in）」＝particularly 何よりもまず，語学を学ぶには強い動機が必要だ。",
        "answer": "Above all",
        "en": "{Above all}, learning a language requires a strong motivation.",
        "explanation": "above all ʮԿΑΓ΋·ͣɼͱΓΘ͚ʯ⇦「 す べ て（all）よ りも 上 に（above）」\nrequire͢Δʯ\n1317-1\n基本\n実は，これら 2 つのことはまったく異なります。\n(        ) (f      ), these two things are very different.\nTip   actuallyactually͸ ʁ͸ ʁ\n1317-1 In fact, these two things are very different.\nin fact\nin truth    ͸ʯ⇦「事実 （fact）の 中（in）で は 」＝actually\nThe fact is (that) …͸…ͩʯ➡231\n1317-2 実のところ，君の意見には賛成できない。\n(A      ) (        ) (        ) (        ) (        ), I don’t agree with you.\nTip  ͸ ʁ ͸ ʁ\n1317-2 As a matter of fact, I don’t agree with you.\nas a matter of fact͏ͱʯ\n⇧「 事 実（fact）の（of）事 柄（a matter）とし て は（as）」\n1317-3 実際には，プラ スチックの使用を完全に避けることは難しいだろう。\n(        ) (p      ), it would be difficult to avoid using plastic completely.\nTip  ͸ ʁ ͸ ʁ\n1317-3 In practice, it would be difficult to avoid using plastic completely.\nin practice\nin reality        ʹ͸ʯ\n⇧「 実 行（practice） ／現実(reality) に お い て は（in）」"
    },
    {
        "id": "1318",
        "ja": "above all ʮԿΑΓ΋·ͣɼͱΓΘ͚ʯ⇦「 す べ て（all）よ りも 上 に（above）」 基本 実は，これら 2 つのことはまったく異なります。 in truth    ͸ʯ⇦「事実 （fact）の 中（in）で は 」＝actually 1317-2 実のところ，君の意見には賛成できない。 ⇧「 事 実（fact）の（of）事 柄（a matter）とし て は（as）」 1317-3 実際には，プラ スチックの使用を完全に避けることは難しいだろう。 ⇧「 実 行（practice） ／現実(reality) に お い て は（in）」",
        "answer": "even now",
        "en": "Japan is an economically rich country, but {even now}, some children",
        "explanation": "do not have enough to eat.\neven now ʮͦΕͰ΋ʯ⇦「今 （now）で も（even）」＝still\n▶ even now は後に否定文が続く ことが多い。この問題文ではeven so でも正解。\neven so ʮͦ͏ͩͱͯ͠΋ʯ＝still ＝nevertheless ＝nonetheless"
    },
    {
        "id": "1319",
        "ja": "even now ʮͦΕͰ΋ʯ⇦「今 （now）で も（even）」＝still ▶ even now は後に否定文が続く ことが多い。この問題文ではeven so でも正解。 日本人の寿命は伸びてきている。その一方で，出生率は低下している。",
        "answer": "On the other hand",
        "en": "Life expectancy in Japan has increased. {On the other hand}, the",
        "explanation": "birth rate is declining.\non the other hand ʮͦͷҰํͰʯ\n⇧ 「２つの手にあるうちの，も う一方の （the other）手（hand）に お い て（on）」"
    },
    {
        "id": "1320",
        "ja": "⇧ 「２つの手にあるうちの，も う一方の （the other）手（hand）に お い て（on）」",
        "answer": "On the contrary",
        "en": "It’s not cold outside. {On the contrary}, it’s quite warm.",
        "explanation": "on the contrary ʮͦΕͲ͜Ζ͔ɼΉ͠Ζʯ\n⇧「 前 に 述 べ た こととは 逆（the contrary）に お い て（on）」\n▶ on the contrary は前文の内容を否定する表現。文頭に置く ことが多い。\nto the contraryʹʧ ʯ―文中や文末で使うことが多い。"
    },
    {
        "id": "1321",
        "ja": "⇧「 前 に 述 べ た こととは 逆（the contrary）に お い て（on）」 ▶ on the contrary は前文の内容を否定する表現。文頭に置く ことが多い。 to the contraryʹʧ ʯ―文中や文末で使うことが多い。",
        "answer": "In contrast",
        "en": "Solar power is clean. {In contrast}, thermal power generation causes",
        "explanation": "pollution.\nin contrast ＝by contrastʮ͜Εʹରͯ͠ɼͦΕʹൺ΂ͯʯ\n⇧「 対 照（contrast）に お い て（in） 」 「対照 （contrast）す る こ と に よっ て（by）」\nin contrast to A ʮA ͱ͸ରরతʹʯ\nthermal power generation ʮՐྗൃిʯ―thermalʮ೤ͷɼԹ౓ͷʯ\npollution ʮԚછʯ"
    },
    {
        "id": "1322",
        "ja": "人類は温室効果ガスを排出し続け，その結果，私たちは地球温暖化に直面し ている。",
        "answer": "as a result",
        "en": "Humans continue to emit greenhouse gases, and {as a result}, we are",
        "explanation": "facing global warming.\nas a resultՌͱ͠ ͯʯ＝consequently ＝as a consequence\nemit greenhouse gasesՌΨεΛഉग़͢Δʯ\nface A೉ͳͲʣʹ௚໘͢Δʯ＝be faced with A ＝be confronted with A"
    },
    {
        "id": "1323",
        "ja": "結局，そのイベントには行かないことにした。",
        "answer": "after all",
        "en": "I decided not to go to that event {after all}.",
        "explanation": "after all͸ʯ＝eventually\n⇧「 す べ て（all）終 わ っ た 後（after）」\ndecide not to do ʮʙ͠ͳ͍͜ͱʹ͢Δʯ"
    },
    {
        "id": "1324",
        "ja": "⇧「 す べ て（all）終 わ っ た 後（after）」 最終的にはすべてうまくいった。",
        "answer": "in the end",
        "en": "It all worked out {in the end}.",
        "explanation": "in the endऴతʹʯ⇦「最後 （the end）の 中 に お い て（in）」\n＝eventually\n▶ 主語It all のit は「状況」を表すit。all が続いて「状況全体」を表している。"
    },
    {
        "id": "1325",
        "ja": "in the endऴతʹʯ⇦「最後 （the end）の 中 に お い て（in）」 ▶ 主語It all のit は「状況」を表すit。all が続いて「状況全体」を表している。 太陽エネルギーは持続可能だ。言いかえれば，決して尽きることはない。",
        "answer": "In other words",
        "en": "Solar energy is sustainable. {In other words}, it will never run out.",
        "explanation": "in other words͍͔͑Ε͹ʯ\n⇧「 他 の（other）言 葉（words）に お い て（in）」\nsustainableଓՄೳͳʯ"
    },
    {
        "id": "1326",
        "ja": "⇧「 他 の（other）言 葉（words）に お い て（in）」",
        "answer": "To put it another way",
        "en": "Pollution is severe everywhere. {To put it another way}, the Earth is",
        "explanation": "getting sick.\nto put it another way͍ํΛ͢Δͱʯ\n⇧ 「今述べたこと （it）を 別 の や り 方 で（another way）言 葉 と し て 置 く（put）と 」\nsevereͳʯ＝very serious"
    },
    {
        "id": "1327",
        "ja": "⇧ 「今述べたこと （it）を 別 の や り 方 で（another way）言 葉 と し て 置 く（put）と 」 他の子どもたちと同じ機会を得られない子どもたちもいる。つまり，貧困は子どもの 教育に影響を与える。",
        "answer": "Some children do not have the same opportunities as others.",
        "en": "{Some children do not have the same opportunities as others.}",
        "explanation": "That is to say, poverty affects children’s education.\nthat is (to say)ʮͭ·Γɼ͢ͳΘͪʯ＝namely\n⇧「 そ れ は（that is）言うなら ば（to say）」\naﬀect AʮA͢Δʯ＝in/f_luence A ＝have an eﬀect on A"
    },
    {
        "id": "1328",
        "ja": "⇧「 そ れ は（that is）言うなら ば（to say）」",
        "answer": "In short",
        "en": "{In short}, Japan is aging rapidly due to its low birth rate and long",
        "explanation": "average life expectancy.\nin short\nin brief     ͑͹ʯ⇦「 短 い（short/brief）中 で（in）」\nin a word͑͹ʯ\nrapidly଎ʹʯ⇔⇔ slowlyʮΏͬ͘Γʯ\naverage life expectancyण໋ʯ"
    },
    {
        "id": "1329",
        "ja": "in brief     ͑͹ʯ⇦「 短 い（short/brief）中 で（in）」",
        "answer": "In conclusion",
        "en": "{In conclusion}, smartphones have become an indispensable part of",
        "explanation": "our daily lives.\nin conclusion࿦ͱ͠ ͯʯ＝to conclude\nindispensableͳɼͳͯ͘͸ͳΒͳ͍ʯ＝essential\n(our) daily livesʯ"
    }
];

        // --- App State ---
        let activeSentenceElement = null;
        let selectedSentences = new Set();
        let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
        }
        
        // --- Voice Synthesis Setup ---
        let synthesisVoice = null;

        function setSynthesisVoice() {
            const voices = speechSynthesis.getVoices();
            // 優先順位: Google US English -> Microsoft Zira/David -> その他英語
            synthesisVoice = voices.find(voice => voice.name === 'Google US English') ||
                             voices.find(voice => voice.name.includes('Google') && voice.lang.includes('en-US')) ||
                             voices.find(voice => voice.name.includes('Microsoft') && voice.lang.includes('en-US')) ||
                             voices.find(voice => voice.lang === 'en-US') ||
                             voices.find(voice => voice.lang.startsWith('en'));
        }

        // 音声リストがロードされたら設定を実行
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = setSynthesisVoice;
        }
        // 初期化時にも実行
        setSynthesisVoice();


        // --- DOM Elements ---
        const sentenceList = document.getElementById('sentence-list');
        const toggleAnswerBtn = document.getElementById('toggle-answer-btn');
        const playSoundBtn = document.getElementById('play-sound-btn');
        const recordBtn = document.getElementById('record-btn');
        const toggleExplanationBtn = document.getElementById('toggle-explanation-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const messageModal = document.getElementById('message-modal');
        const messageContent = document.getElementById('message-content');
        const quizModal = document.getElementById('quiz-modal');
        const closeQuizBtn = document.getElementById('close-quiz-btn');
        const quizContent = document.getElementById('quiz-content');
        
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const pdfModal = document.getElementById('pdf-modal');
        const openPdfModalBtn = document.getElementById('open-pdf-modal-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');


        // --- Functions ---

        /**
         * Parses the English sentence template and creates the HTML structure.
         */
        function formatEnglishSentence(enTemplate, answer) {
            const blank = '__________';
            const answerHtml = `<span class="answer-span">${answer}</span>`;
            const underlineHtml = `<span class="underline-span">${blank}</span>`;
            const formattedSentence = enTemplate.replace(`{${answer}}`, `${answerHtml}${underlineHtml}`);
            return formattedSentence;
        }

        /**
         * Renders all sentences for the chapter.
         */
        function renderChapter() {
            sentenceList.innerHTML = '';
            chapterData.forEach(item => {
                const sentenceDiv = document.createElement('div');
                sentenceDiv.className = 'sentence-item p-4 border border-gray-200 rounded-lg bg-white transition-shadow duration-300 hover:shadow-md cursor-pointer';
                sentenceDiv.dataset.id = item.id;
                sentenceDiv.dataset.fullSentence = item.en.replace(`{${item.answer}}`, item.answer);

                const englishSentenceHtml = formatEnglishSentence(item.en, item.answer);

                sentenceDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                         <div class="flex items-center pt-1" onclick="event.stopPropagation()">
                            <input type="checkbox" class="sentence-checkbox h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500" data-id="${item.id}">
                        </div>
                        <span class="text-lg font-bold text-gray-500 w-10 shrink-0 pt-1">${item.id}</span>
                        <div class="flex-1">
                            <p class="mb-2 text-gray-700">${item.ja}</p>
                            <p class="font-english">${englishSentenceHtml}</p>
                            <div class="explanation mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-400 text-gray-700 rounded-r-lg">
                                ${item.explanation}
                            </div>
                        </div>
                    </div>
                `;
                sentenceList.appendChild(sentenceDiv);
            });
            
            // Add click listener to each sentence item
            document.querySelectorAll('.sentence-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    // Don't select if clicking inside explanation
                    if (e.target.closest('.explanation')) return;
                    if (e.target.closest('.sentence-checkbox')) return; // Checkbox click is handled separately

                    if (activeSentenceElement) {
                        activeSentenceElement.classList.remove('ring-2', 'ring-blue-400', 'shadow-xl');
                    }
                    activeSentenceElement = item;
                    activeSentenceElement.classList.add('ring-2', 'ring-blue-400', 'shadow-xl');
                });
            });

            // Checkbox logic
            document.querySelectorAll('.sentence-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const id = e.target.dataset.id;
                    if (e.target.checked) {
                        selectedSentences.add(id);
                    } else {
                        selectedSentences.delete(id);
                    }
                });
            });
            
            // Select the first sentence by default
            if (sentenceList.firstChild) {
                 sentenceList.firstChild.click();
            }
        }
        
        // --- PDF / Print Logic ---
        
        function openPrintWindow(bodyContent, title) {
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="ja">
                <head>
                    <meta charset="UTF-8">
                    <title>Insight App - Chapter 26</title>
                    <style>
                        body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; line-height: 1.8; margin: 25px; color: #333; }
                        @media print { .no-print { display: none; } }
                        h1, h2 { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 25px; }
                        ol, ul { list-style-position: inside; padding-left: 0; }
                        li { margin-bottom: 15px; }
                        .list-container { 
                            column-count: 2; 
                            column-gap: 40px; 
                        }
                        .list-container li, .list-container p { 
                            -webkit-column-break-inside: avoid; 
                            page-break-inside: avoid; 
                            break-inside: avoid; 
                        }
                        ol li {
                            list-style-type: decimal;
                            margin-left: 1.5em; 
                        }
                        .inline-content {
                            display: inline;
                        }
                        @media (max-width: 700px) { .list-container { column-count: 1; } }
                        .answer-key { page-break-before: always; margin-top: 50px; }
                        u { text-decoration: underline; text-underline-offset: 3px; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <p class="no-print" style="text-align:center; margin-bottom: 20px; font-size: 0.9em; color: #666;">
                        ※印刷ダイアログが表示されない場合は、Ctrl+P (または Cmd+P) を押してください。
                    </p>
                    ${bodyContent}
                </body>
                </html>
            `;
            const printWindow = window.open('', '_blank');
            if (!printWindow) {
                showMessage('<p>ポップアップがブロックされました。設定を確認してください。</p>', 5000);
                return;
            }
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.focus(); 
                printWindow.print();
            }, 250);
        }

        function getSelectedItems() {
            if (selectedSentences.size === 0) {
                showMessage('<p>PDFを作成する問題を選択してください。</p>', 3000);
                return null;
            }
            // Sort items based on ID
            return Array.from(selectedSentences)
                .map(id => chapterData.find(item => item.id === id))
                .filter(Boolean)
                .sort((a, b) => {
                     // Handle IDs like "1382-1" vs "1382-2"
                     const aParts = a.id.split('-').map(s => parseInt(s) || 0);
                     const bParts = b.id.split('-').map(s => parseInt(s) || 0);
                     if (aParts[0] !== bParts[0]) return aParts[0] - bParts[0];
                     return (aParts[1] || 0) - (bParts[1] || 0);
                });
        }
        
        function getUniqueItems(items) {
             const uniqueMap = new Map();
             items.forEach(item => {
                 // Use answer as key to deduplicate same phrases
                 if (!uniqueMap.has(item.answer)) {
                     uniqueMap.set(item.answer, item);
                 }
             });
             return Array.from(uniqueMap.values()).sort((a, b) => {
                 const aId = parseInt(a.id.split('-')[0]);
                 const bId = parseInt(b.id.split('-')[0]);
                 return aId - bId;
             });
        }


        // --- Message & Sound Functions ---
        
        function showMessage(htmlContent, duration = null) {
            messageContent.innerHTML = htmlContent;
            messageModal.classList.remove('hidden');
            if (duration) {
                setTimeout(() => {
                    messageModal.classList.add('hidden');
                }, duration);
            }
        }

        function playSound() {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }

            // 音声が未設定なら再取得を試みる
            if (!synthesisVoice) {
                setSynthesisVoice();
            }

            // 連続再生を防ぐために一度キャンセル
            speechSynthesis.cancel();
            
            let textToSpeak = activeSentenceElement.dataset.fullSentence;
            // 念のため不要な記号を除去
            textToSpeak = textToSpeak.replace(/[{}]/g, '');

            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'en-US';

            // 英語音声が取得できていれば設定
            if (synthesisVoice) {
                utterance.voice = synthesisVoice;
            }

            utterance.rate = 1.0; 
            utterance.pitch = 1.0;

            speechSynthesis.speak(utterance);
        }

        function handleRecording() {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            if (!SpeechRecognition) {
                showMessage('<p>お使いのブラウザは音声認識に対応していません。</p>', 3000);
                return;
            }

            showMessage('<p class="text-2xl">マイクに向かって話してください...</p><div class="animate-pulse text-red-500 text-4xl mt-4">●</div>');
            
            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                evaluatePronunciation(transcript);
            };

            recognition.onerror = (event) => {
                showMessage(`<p>エラーが発生しました: ${event.error}</p>`, 3000);
            };
            
            recognition.onend = () => {
                 if (messageModal.classList.contains('hidden') === false && messageContent.innerHTML.includes('マイクに')) {
                    messageModal.classList.add('hidden');
                 }
            };
        }
        
        function evaluatePronunciation(transcript) {
            const originalText = activeSentenceElement.dataset.fullSentence;

            const cleanOrig = originalText.toLowerCase().replace(/[^\w\s]/g, '').split(' ');
            const cleanTrans = transcript.toLowerCase().replace(/[^\w\s]/g, '').split(' ');
            
            let matches = 0;
            cleanOrig.forEach(word => {
                if (cleanTrans.includes(word)) {
                    matches++;
                }
            });

            const similarity = matches / cleanOrig.length;
            
            let score;
            if (similarity > 0.9) {
                score = 95 + Math.floor(Math.random() * 5);
            } else if (similarity > 0.7) {
                score = 90 + Math.floor(Math.random() * 6);
            } else if (similarity > 0.5) {
                score = 85 + Math.floor(Math.random() * 5);
            } else if (similarity > 0.3) {
                score = 80 + Math.floor(Math.random() * 5);
            } else {
                score = 70 + Math.floor(Math.random() * 10);
            }
            
            if (score === 100 && Math.random() < 0.3) score = 99;

            const messageHtml = `
                <h3 class="text-2xl font-bold mb-4">評価結果</h3>
                <p class="text-7xl font-bold text-blue-600 mb-4">${score}<span class="text-2xl">点</span></p>
                <p class="text-gray-600 mb-2"><strong>あなたの発音:</strong> ${transcript}</p>
                <p class="text-gray-600"><strong>元の文:</strong> ${originalText}</p>
                <button onclick="document.getElementById('message-modal').classList.add('hidden')" class="mt-6 bg-blue-500 text-white py-2 px-6 rounded-lg">閉じる</button>
            `;
            showMessage(messageHtml);
        }

        // --- Quiz Functions ---

        function startQuiz() {
            if (chapterData.length < 10) {
                 showMessage('<p>クイズを作成するには、文が10個以上必要です。</p>', 3000);
                 return;
            }

            const shuffled = [...chapterData].sort(() => 0.5 - Math.random());
            const questions = shuffled.slice(0, 10);

            let currentQuestionIndex = 0;
            let score = 0;

            function showQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    showQuizResult();
                    return;
                }

                const question = questions[currentQuestionIndex];
                const correctAnswer = question.answer;

                const incorrectAnswers = chapterData
                    .filter(item => item.answer !== correctAnswer)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(item => item.answer);

                const options = [correctAnswer, ...incorrectAnswers].sort(() => 0.5 - Math.random());
                
                const questionSentence = question.en.replace(`{${question.answer}}`, ' (______) ');

                quizContent.innerHTML = `
                    <h3 class="text-2xl font-bold mb-2">問題 ${currentQuestionIndex + 1}/10</h3>
                    <p class="text-lg mb-4">${question.ja}</p>
                    <p class="font-english text-xl mb-6 p-4 bg-gray-100 rounded-lg">${questionSentence}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${options.map(opt => `<button class="quiz-option p-4 bg-blue-100 hover:bg-blue-200 rounded-lg text-left text-lg font-english" data-answer="${opt}">${opt}</button>`).join('')}
                    </div>
                `;

                document.querySelectorAll('.quiz-option').forEach(button => {
                    button.addEventListener('click', () => {
                        if (button.dataset.answer === correctAnswer) {
                            score++;
                            button.classList.add('bg-green-400', 'text-white');
                        } else {
                            button.classList.add('bg-red-400', 'text-white');
                            document.querySelector(`.quiz-option[data-answer="${CSS.escape(correctAnswer)}"]`).classList.add('bg-green-400', 'text-white');
                        }
                        
                        setTimeout(() => {
                            currentQuestionIndex++;
                            showQuestion();
                        }, 1200);
                    });
                });
            }

            function showQuizResult() {
                quizContent.innerHTML = `
                    <h3 class="text-3xl font-bold mb-4 text-center">テスト終了！</h3>
                    <p class="text-center text-xl mb-6">あなたのスコアは...</p>
                    <p class="text-center text-7xl font-bold text-purple-600">${score * 10}<span class="text-3xl">点</span></p>
                    <p class="text-center text-xl mt-2">(${questions.length}問中 ${score}問正解)</p>
                `;
            }

            showQuestion();
            quizModal.classList.remove('hidden');
        }


        // --- Event Listeners ---

        toggleAnswerBtn.addEventListener('click', () => {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            activeSentenceElement.classList.toggle('show-answer');
        });

        toggleExplanationBtn.addEventListener('click', () => {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            const explanationDiv = activeSentenceElement.querySelector('.explanation');
            if (explanationDiv.style.display === 'block') {
                explanationDiv.style.display = 'none';
            } else {
                explanationDiv.style.display = 'block';
            }
        });
        
        playSoundBtn.addEventListener('click', playSound);
        recordBtn.addEventListener('click', handleRecording);
        startQuizBtn.addEventListener('click', startQuiz);
        closeQuizBtn.addEventListener('click', () => quizModal.classList.add('hidden'));
        
        // Select All Logic
        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const checkboxes = document.querySelectorAll('.sentence-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = isChecked;
                if (isChecked) selectedSentences.add(cb.dataset.id);
                else selectedSentences.delete(cb.dataset.id);
            });
        });

        // PDF Modal Logic
        openPdfModalBtn.addEventListener('click', () => {
             if (selectedSentences.size === 0) {
                showMessage('<p>PDFを作成する問題を選択してください。</p>', 3000);
                return;
            }
            pdfModal.classList.remove('hidden');
        });
        closeModalBtn.addEventListener('click', () => pdfModal.classList.add('hidden'));

        // --- PDF Generation Buttons Listeners ---

        // 変更: PDF内のサブタイトルを「Insight 英文法・語法・熟語 ＋ 章とその題」の形式にする
        // h1: "Insight 英文法・語法・熟語"
        // h2: "学習用サイト（28章 その他の重要熟語）" -> "（28章 その他の重要熟語）" の部分を抽出して結合
        const mainTitle = document.querySelector('header h1').innerText;
        const subTitleRaw = document.getElementById('app-subtitle').innerText;
        // "学習用サイト" という文字が含まれていれば削除して整形
        const chapterTitle = subTitleRaw.replace('学習用サイト', '').trim();
        const subtitleText = `${mainTitle} ${chapterTitle}`;

        // 1. 完全なリスト
        document.getElementById('download-list-btn').addEventListener('click', () => {
            const items = getSelectedItems();
            if(!items) return;
            // リスト作成の場合は重複があっても良いが、見やすくするために熟語ベースでユニークにするか、
            // そのままID順で並べるか。ここではID順ですべて表示する。
            
            const listItems = items.map(item => {
                // Remove { } for clean display
                const cleanEn = item.en.replace(/[{}]/g, '');
                return `<li>
                    <span class="inline-content"><strong>${item.answer}</strong>: ${item.explanation.replace(/\n/g, '<br>')}</span><br>
                    <span style="font-size:0.9em; color:#555;">Ex: ${cleanEn} / ${item.ja}</span>
                </li>`;
            }).join('');
            
            openPrintWindow(`<ul class="list-container">${listItems}</ul>`, '重要熟語リスト');
            pdfModal.classList.add('hidden');
        });

        // 2. 英語を解答
        document.getElementById('download-en-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            
            const quizItems = items.map(item => 
                `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')} : ____________________</span></li>`
            ).join('');
            const answerItems = items.map(item => 
                `<li><span class="inline-content">${item.answer}</span></li>`
            ).join('');
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (英語を解答)');
            pdfModal.classList.add('hidden');
        });

        // 3. 意味を解答
        document.getElementById('download-ja-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            
            const quizItems = items.map(item => 
                `<li><span class="inline-content"><strong>${item.answer}</strong> : ____________________</span></li>`
            ).join('');
            const answerItems = items.map(item => 
                `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')}</span></li>`
            ).join('');
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (意味を解答)');
            pdfModal.classList.add('hidden');
        });

        // 4. 混合
        document.getElementById('download-mixed-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            let quizItems = '';
            let answerItems = '';
            
            items.forEach(item => {
                if (Math.random() > 0.5) {
                    // 日本語 -> 英語
                    quizItems += `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')} : ____________________</span></li>`;
                    answerItems += `<li><span class="inline-content">${item.answer}</span></li>`;
                } else {
                    // 英語 -> 日本語
                    quizItems += `<li><span class="inline-content"><strong>${item.answer}</strong> : ____________________</span></li>`;
                    answerItems += `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')}</span></li>`;
                }
            });
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (混合)');
            pdfModal.classList.add('hidden');
        });

        // 5. 例文穴埋め
        document.getElementById('download-sentence-quiz-btn').addEventListener('click', () => {
            const items = getSelectedItems(); // 例文問題なので重複（文脈違い）も含める
            
            const quizItems = items.map(item => {
                // Replace {answer} with underscore
                const blankSentence = item.en.replace(`{${item.answer}}`, '____________________');
                return `<li>${blankSentence}<br><span style="font-size:0.9em;">(${item.ja})</span></li>`;
            }).join('');
            
            const answerItems = items.map(item => 
                `<li>${item.answer}</li>`
            ).join('');

            const body = `<h2>${subtitleText}</h2><ol>${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (例文穴埋め)');
            pdfModal.classList.add('hidden');
        });

        // 6. 例文混合 (穴埋め / 下線部和訳)
        document.getElementById('download-sentence-mixed-quiz-btn').addEventListener('click', () => {
            const items = getSelectedItems();
            let quizItems = '';
            let answerItems = '';
            
            const instruction = '<p style="border:1px solid #ccc; padding:10px; margin-bottom:20px;">指示：空所には適切な語句を補い、下線部がある文は下線部の意味を日本語で答えなさい。</p>';

            items.forEach(item => {
                if (Math.random() > 0.5) {
                    // 穴埋め
                    const blankSentence = item.en.replace(`{${item.answer}}`, '____________________');
                    quizItems += `<li>${blankSentence}<br><span style="font-size:0.9em;">(${item.ja})</span></li>`;
                    answerItems += `<li>${item.answer}</li>`;
                } else {
                    // 下線部和訳 (ここでは熟語の意味を問う形にする)
                    const underlineSentence = item.en.replace(`{${item.answer}}`, `<u>${item.answer}</u>`);
                    quizItems += `<li>${underlineSentence}<br>意味: ____________________</li>`;
                    answerItems += `<li>${item.explanation.split('\n')[0]}</li>`; // 解説の1行目を答えとする
                }
            });

            const body = `<h2>${subtitleText}</h2>${instruction}<ol>${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (例文混合)');
            pdfModal.classList.add('hidden');
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            renderChapter();
        });
    </script>
</body>
</html>