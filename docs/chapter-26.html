<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insight App - Chapter 26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Tinos:wght@700&display=swap');
        
        body {
            background-color: #007BFF; /* ビビットなブルー */
            font-family: 'Noto Sans JP', sans-serif;
        }

        /* 英語フォントをTimes New Romanに設定 */
        .font-english {
            font-family: 'Tinos', 'Times New Roman', serif;
            font-weight: 700;
            font-size: 1.25rem; /* 20px */
            line-height: 1.75rem; /* 28px */
        }

        .answer-span {
            color: #DC2626; /* 赤色 */
            font-weight: 700;
            display: none;
        }

        .underline-span {
            text-decoration: underline;
            text-underline-offset: 4px;
            display: inline;
        }

        .show-answer .answer-span {
            display: inline;
        }

        .show-answer .underline-span {
            display: none;
        }
        
        .explanation {
            display: none;
            white-space: pre-wrap;
        }

        /* Button Styles for Modal */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8 bg-blue-500 p-4 rounded-xl shadow-lg">
            <h1 class="text-2xl md:text-3xl font-bold text-white">Insight 英文法・語法・熟語</h1>
            <h2 id="app-subtitle" class="text-xl md:text-2xl font-bold text-white">学習用サイト（Chapter 26）</h2>
        </header>

        <main class="bg-white/90 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-28">
            <div class="flex justify-between items-center mb-6">
                 <!-- PDF Control Section -->
                 <div class="flex-1 mr-4">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <h3 class="font-bold text-sm md:text-base mb-2">選択した問題でPDFを作成</h3>
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="select-all-checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <label for="select-all-checkbox" class="ml-2 text-sm font-medium text-gray-700 cursor-pointer">すべて選択 / 解除</label>
                            </div>
                            <button id="open-pdf-modal-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow text-sm transition-transform transform hover:scale-105">
                                PDF作成メニュー
                            </button>
                        </div>
                    </div>
                </div>

                <button id="start-quiz-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105 whitespace-nowrap">
                    ランダムテスト
                </button>
            </div>

            <div id="sentence-list" class="space-y-6">
                <!-- Sentences will be populated by JS -->
            </div>
        </main>
    </div>

    <!-- Control Panel -->
    <div id="control-panel" class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md p-4 border-t-2 border-gray-200 shadow-2xl flex justify-center items-center space-x-2 md:space-x-4">
        <button id="toggle-answer-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">表示/非表示</button>
        <button id="play-sound-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">音声再生</button>
        <button id="record-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">録音評価</button>
        <button id="toggle-explanation-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">解説</button>
    </div>

    <!-- Message/Score Modal -->
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div id="message-content" class="bg-white p-8 rounded-lg shadow-xl text-center">
            <!-- Message content will be populated by JS -->
        </div>
    </div>
    
    <!-- Quiz Modal -->
    <div id="quiz-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-40 p-4">
        <div class="bg-white w-full max-w-2xl p-8 rounded-2xl shadow-2xl relative">
            <button id="close-quiz-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold">&times;</button>
            <div id="quiz-content">
                <!-- Quiz content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- PDF Download Modal -->
    <div id="pdf-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">ダウンロードするPDFの種類を選択</h3>
                <div class="mt-2 space-y-3">
                    <button id="download-list-btn" class="btn btn-primary w-full justify-start text-left">1. 完全なリスト (熟語・意味・例文)</button>
                    <button id="download-en-quiz-btn" class="btn btn-primary w-full justify-start text-left">2. 熟語テスト (英語を解答)</button>
                    <button id="download-ja-quiz-btn" class="btn btn-primary w-full justify-start text-left">3. 熟語テスト (意味を解答)</button>
                    <button id="download-mixed-quiz-btn" class="btn btn-primary w-full justify-start text-left">4. 熟語テスト (混合)</button>
                    <button id="download-sentence-quiz-btn" class="btn btn-primary w-full justify-start text-left">5. 例文の穴埋め問題</button>
                    <button id="download-sentence-mixed-quiz-btn" class="btn btn-primary w-full justify-start text-left">6. 例文の混合問題 (穴埋め/和訳)</button>
                </div>
                <div class="mt-6">
                    <button id="close-modal-btn" class="btn btn-secondary w-full">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chapterData = [
    {
        "id": "1",
        "ja": "2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語 2 3 4 5 6 7 8 9 10音読 副詞の働きをする熟語",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Self Check"
    },
    {
        "id": "26",
        "ja": "副詞の働きをする熟語 ◀\t音読用動画 別解など 副詞の働きをする熟語 熟語編 ｜  26章 副詞の働きをする熟語② 熟語編 ｜  26章 副詞の働きをする熟語③ 熟語編 ｜  26章 副詞の働きをする熟語④ 熟語編 ｜  26章 副詞の働きをする熟語⑤ 熟語編 ｜  26章 副詞の働きをする熟語⑥ 熟語編 ｜  26章 副詞の働きをする熟語⑦ 熟語編 ｜  26章 副詞の働きをする熟語⑧ 熟語編 ｜  26章 副詞の働きをする熟語⑨ 熟語編 ｜  26章 副詞の働きをする熟語⑩ 熟語編 ｜  26章 副詞の働きをする熟語⑪",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "①"
    },
    {
        "id": "1246",
        "ja": "ちょうど今，忙しいんです。後で話せますか。",
        "en": "I’m busy right now. Can we talk later? right now  ͙͢ʢ＝immediatelyʣʯ by now͸ʯ",
        "answer": "right now. Can we talk later? right now ͙͢ʢ＝immediatelyʣʯ by now͸ʯ",
        "explanation": "",
        "question": "I’m busy (        ) (n      ). Can we talk later?"
    },
    {
        "id": "1247",
        "ja": "「すぐに来 て く れ ま す か 。」「 了 解 ！ 」",
        "en": "“Can you come {right away?” “Sure!” right away ʮ͙͢ʹʯ ＝immediately ＝instantly}",
        "answer": "right away?” “Sure!” right away ʮ͙͢ʹʯ ＝immediately ＝instantly",
        "explanation": "",
        "question": "“Can you come (r      ) (        ) ?” “Sure!”"
    },
    {
        "id": "1248",
        "ja": "バスに乗るためにすぐに出発しなければならない。 ⇧ 「一度 （once）の 時 点 で（at） ⭢ 同時に」 「すると決めた時と同時に ⭢ すぐに」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I have to leave (a      ) (        ) to catch the bus. I have to leave at once to catch the bus. at once  ᶃʮ ͢ ͙ ʹʢ＝immediatelyʹ ʢ＝at the same timeʣʯ all at once  ᶃʮ ಥ વʢ＝suddenlyʣʯ ᶄʮ ͍ ͬ ͤ ͍ ʹ ʯ"
    },
    {
        "id": "1249",
        "ja": "発展 私はその場でチームに加わることを決めた。 ⇧「 そ の 場 所（the spot）で（on）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I decided to join the team (o      ) (        ) (        ). I decided to join the team on the spot. on the spotʹʢ＝immediatelyʣʯ joinͳͲʣͷҰһͱͳΔʯ"
    },
    {
        "id": "1250",
        "ja": "すぐに参ります。 ⇧ 「一瞬の （a minute） ／時間がない （no time）う ち に（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I’ll be with you (        ) (        ) (m     ). I’ll be with you in a minute. in a minute in no time       ʮ͙͢ʹʯ＝very soon ＝in a moment ＝in a second"
    },
    {
        "id": "1251",
        "ja": "その法律はまもなく可決されるだろう。 ⇧「 長 く（long）に な る 前 に（before）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "That law will be passed (b      ) (        ). That law will be passed before long. before long ʮ·΋ͳ͘ʯ＝soon"
    },
    {
        "id": "1252",
        "ja": "現在，社会保障費の増加が大きな問題となっ ている。 ⇧「 現 在（present）の 時 点 で（at）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (p      ), the increase in social security costs is a big problem. At present, the increase in social security costs is a big problem. at presentͷͱ͜Ζ͸ʯ＝currently for the presentɼ͠͹Β͘͸ʯ＝for the time being  ➡1255 social security costsձอোඅʯ"
    },
    {
        "id": "1253",
        "ja": "昔は，今よりもっとビニール袋を使っていた。",
        "en": "{In the past, we used more plastic bags than we do today. in the pastʹʯ a plastic bag ʮϏχʔϧାʯ}",
        "answer": "In the past, we used more plastic bags than we do today. in the pastʹʯ a plastic bag ʮϏχʔϧାʯ",
        "explanation": "",
        "question": "(        ) (        ) (p      ), we used more plastic bags than we do today."
    },
    {
        "id": "1254",
        "ja": "ネットショッピングのこうした流行は今後も続くだろう。 復習 26章",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "This trend of online shopping will continue (        ) (        ) (f      ). This trend of online shopping will continue in the future. in the future͸ʯ in the near future͍কདྷʯ trendʯ 450 451 for / while / along / so / as"
    },
    {
        "id": "1255",
        "ja": "発展 この話題はしばらく置 いておこう。 ⇧「 今 こ の 時（the time）が 存 在 す る（being）間（for）は 」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Let’s put this topic aside (        ) (        ) (t      ) (b      ). Let’s put this topic aside for the time being. for the time being for the present          ɼ͠͹Β͘͸ʯ at presentͷͱ͜Ζ͸ʯ＝currently  ➡1252 put aside A / put A aside  ᶃʮA Λऔ͓ͬͯ͘ʯ ᶄʮAʢ໰୊ͳͲʣΛอཹʹ͢Δʯ"
    },
    {
        "id": "1256",
        "ja": "ナオミはどうしていますか 。しばらく彼女に会っていないけれど。 ⇧「 し ば ら く（a while）の 間（for）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "How’s Naomi? I haven’t seen her (f      ) (        ) (        ). How’s Naomi? I haven’t seen her for a while. for a whileʯ"
    },
    {
        "id": "1257",
        "ja": "し ば らくして，気分はだいぶ良く なった。 ⇧「 し ば ら く（a while）し た 後（after）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ) (w     ), I felt much better. After a while, I felt much better. after a while ʮ͠͹Βͯ͘͠ʯ feel much better෼͕͍ͣͿΜྑ͘ͳΔʯ"
    },
    {
        "id": "1258",
        "ja": "長い間，ビーチに行っていない 。 ⇧ 「長期間 （ages）の 間（for）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I haven’t been to the beach (        ) (        ). I haven’t been to the beach for ages. for agesʯ＝for a long time for years ʮԿ೥΋ʯ"
    },
    {
        "id": "1259",
        "ja": "父はたばこを永久にやめたと言っていた。",
        "en": "My father said he quit smoking {for good. for goodʹʯ＝forever ＝permanently}",
        "answer": "for good. for goodʹʯ＝forever ＝permanently",
        "explanation": "▶ イギリスではfor good and allも同じ意味で使われる。",
        "question": "My father said he quit smoking (        ) (        )."
    },
    {
        "id": "1260",
        "ja": "発展 私たちはこの問題についてきっぱりと決着をつける必要がある。 ⇧「 一 度（once）そし て（and）そ れ が 全 部 の 代 わ り（for all）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "We need to settle this matter (o      ) (        ) (        ) (        ). We need to settle this matter once and for all. once and for allʹɼ͖ͬͺΓͱʯ settle͢Δʢ＝resolveʣʯ"
    },
    {
        "id": "1261",
        "ja": "鍵がずっとバッグの中にあったことに気がついた。 ⇧「 全 部（all）に 沿 っ て（along）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I realized that my keys were in the bag (        ) (a      ). I realized that my keys were in the bag all along. all along ʮͣͬͱʢ＝all the time)ɼ ॳ Ί ͔ Βʢ＝from the beginningʣʯ"
    },
    {
        "id": "1262",
        "ja": "これまでに，5 人の生徒がこのプロジェクトに集まった。",
        "en": "{So far, five students have come together for this project.}",
        "answer": "So far, five students have come together for this project.",
        "explanation": "▶ so far / until now / up to now は現在完了形と共に使うことが多い。\n⇔ from now on͸ʯ\ncome together ʮʢάϧ ʔϓͱͯ͠ʣू·Δʯ",
        "question": "(S      ) (        ), five students have come together for this project."
    },
    {
        "id": "1263",
        "ja": "発展 これまでのところ，その行方不明の旅行者に関する情報はない。 否定文や否定語と共に使うことが多い。 復習 私たちは今でも時々メッセージを送り合う。 発展 誰でもたまには間違いをする。 ⇧「 し ば らくの 間（a while）の 中 で（in）一 度（once）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(A      ) (        ), there is no information about the missing tourist. As yet, there is no information about the missing tourist. as yetͷͱ͜Ζʢʙͳ͍ʣʯ A …, (and) yet B …ʮA …͕ͩB …ɼA …͔͠͠B …ʯ➡846-3 missingํෆ໌ͷʯ 452 453 Self Check rule / large 1264-1 We still text each other (f      ) (        ) (        ) (        ). 1264-1 We still text each other from time to time. from time to time at times                        ʑʯ ＝sometimes at a time ʮҰ౓ʹʯ at the same timeʹʯ 1264-2 Everyone makes mistakes (o      ) (        ) (        ) (        ). 1264-2 Everyone makes mistakes once in a while. once in a while (every) now and then (every) now and again      ંʯ on occasion (s) ＝occasionally make a mistakeҧ͍Λ͢Δʯ"
    },
    {
        "id": "1265",
        "ja": "発展 今日は一日中，雨が降ったりやんだりしている。",
        "en": "It’s been raining on and oﬀ all day today. on and off off and on    ʮஅଓతʹʯ ⇧「 付 い て（on）そし て（and）離 れ て（off）」 all day (long)ʮҰ೔தʯ⇔⇔ all night (long)ʮҰ൩தʯ ▼1266～1267ʫ 1266-1 基本 一般的に，日本の夏は蒸し暑い。 (I      ) (        ), summers in Japan are hot and humid. 1266-1 In general, summers in Japan are hot and humid. in general             ᶃ ʮҰൠతʹʢ＝generallyʣʯ as a whole            ᶄ ʮશମͱ͠ ͯʢ＝all in allʣʯ on the whole    ᶅ ʮʙશମʢ＝ ～ at largeʣʯ hot and humid ʮৠ͠ॵ͍ʯ―humidͷ͋Δʯ 1266-2 全 体として，試験はうまくいった。 (O      ) (        ) (        ), I did well in my exams. 1266-2 On the whole, I did well in my exams.",
        "answer": "on and oﬀ all day today. on and off off and on ʮஅଓతʹʯ ⇧「 付 い て（on）そし て（and）離 れ て（off）」 all day longʮҰ೔தʯ⇔⇔ all night longʮҰ൩தʯ ▼1266～1267ʫ 1266-1 基本 一般的に，日本の夏は蒸し暑い。 I   , summers in Japan are hot and humid. 1266-1 In general, summers in Japan are hot and humid. in general ᶃ ʮҰൠతʹʢ＝generallyʣʯ as a whole ᶄ ʮશମͱ͠ ͯʢ＝all in allʣʯ on the whole ᶅ ʮʙશମʢ＝ ～ at largeʣʯ hot and humid ʮৠ͠ॵ͍ʯ―humidͷ͋Δʯ 1266-2 全 体として，試験はうまくいった。 O     , I did well in my exams. 1266-2 On the whole, I did well in my exams.",
        "explanation": "▶ on the whole 「一般的に，全体と して，～全体」➡1266-1\ndo well ʮ͏·͘΍Δʯ＝succeed\n1267-1 たいてい，私はバスで学校に行くが，時々歩く こ ともある。\n(A      ) (        ) (        ), I take the bus to school, but sometimes I walk.\n1267-1 As a rule, I take the bus to school, but sometimes I walk.\nas a (general) rule\n͠ ͯɼҰൠతʹʢ＝generallyʣʯ ᶄʮ ͨ ͍ ͯ ͍ʢ＝usuallyʣʯ\n⇧ 「一般的な （general）規 則（a rule）とし て（as）」\n1267-2 一般的に，日本の６月は雨が多い。\n(B      ) (        ) (        ), it rains a lot in June in Japan.\n1267-2 By and large, it rains a lot in June in Japan.\nby and large͠ ͯɼҰൠతʹʯ\n⇧「 近 く（by）も（and）幅 広 く（large）も 」\n＝generally ＝as a (general) rule\nit rains a lotΔʯ\n⇔⇔ it doesn’t rain muchΒͳ͍ʯ\n454 455\nSelf\nCheck\n復習",
        "question": "It’s been raining (        ) (        ) (        ) all day today."
    },
    {
        "id": "1267",
        "ja": "???",
        "en": "sea / air ▼ 1268～1277ʪbyʫ",
        "answer": "???",
        "explanation": "",
        "question": "???"
    },
    {
        "id": "1268",
        "ja": "そのショッピングモールで偶然，昔の友達に会った。",
        "en": "I met my old friend {by chance at the mall.}",
        "answer": "by chance at the mall.",
        "explanation": "▶ by は前置詞で「～によって，～経由で，～単位で，～のそばに」などの意味。\nby chance\nby accident    વʹʯ＝accidentally\nchance, accident には「偶然」という意味がある。",
        "question": "I met my old friend (        ) (        ) at the mall."
    },
    {
        "id": "1269",
        "ja": "発展 「ひょっとして， ハ リ ス さ ん で す か 。」「 は い ， 私 で す 。」 ⇧「 少 し の（any）偶 然（chance）に よっ て（by）」 疑問文で使う。",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "“Are you Ms. Harris, (        ) (        ) (        )?” “Yes, I am.” “Are you Ms. Harris, by any chance?” “Yes, I am.” by any chance ʮ ͻΐͬͱͯ͠ʢʙ͔ʣʯ＝perhaps"
    },
    {
        "id": "1270",
        "ja": "重 要なファイルを誤って削 除してしまった 。どうにかして元 に戻 せません か 。 ⇧「 誤 り（mistake）に よっ て（by）」 deleteআ͢Δʯ―パソコンのデリートキーは「削除キー」のこと。",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I’ve deleted an important file (        ) (m     ). Can I recover it somehow? I’ve deleted an important file by mistake. Can I recover it somehow? by mistakeҧͬͯʯ＝mistakenly ＝accidentally make a mistakeҧ͍Λ͢Δʯ recover ʮճ෮͢ΔɼʙΛऔΓ໭͢ʯ"
    },
    {
        "id": "1271",
        "ja": "これらの木製の椀は手作業で作られている。",
        "en": "These wooden bowls are crafted by hand. wooden bowl ʮ໦੡ͷ࿶ʯ craft  Δʯ",
        "answer": "by hand. wooden bowl ʮ໦੡ͷ࿶ʯ craft Δʯ",
        "explanation": "",
        "question": "These wooden bowls are crafted (        ) (        )."
    },
    {
        "id": "1272",
        "ja": "猫は生まれつき独立心が強い。 ⇧「 天 性（nature）に よっ て（by）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Cats are independent (        ) (        ). Cats are independent by nature. by nature ʮੜ·Ε͖ͭʯ＝naturally"
    },
    {
        "id": "1273",
        "ja": "マリは生まれは日本だが ， 長い間フランスに住んでいる。 ⇧「 誕 生（birth）に よっ て（by）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Mari is Japanese (        ) (        ), but has lived in France for a long time. Mari is Japanese by birth, but has lived in France for a long time. by birth ʮੜ·Ε͸ʯ for a long timeʯ＝for ages"
    },
    {
        "id": "1274",
        "ja": "空輸よりも海上輸送のほうが環境に優しい。",
        "en": "It is more environmentally friendly to ship goods {by sea than by air. environmentally friendlyʹ༏͍͠ʯ＝eco-friendly ⇔⇔ environmentally damagingഁյతͳʯ}",
        "answer": "by sea than by air. environmentally friendlyʹ༏͍͠ʯ＝eco-friendly ⇔⇔ environmentally damagingഁյతͳʯ",
        "explanation": "",
        "question": "It is more environmentally friendly to ship goods (        ) (s      ) than (        ) (        )."
    },
    {
        "id": "1275",
        "ja": "徐々に私たちの友情は深まっていった。 ⇧ 「度合い （degrees）の 単 位 で（by）」 復習",
        "en": "{by / cost}",
        "answer": "by / cost",
        "explanation": "",
        "question": "(        ) (        ), our friendship grew stronger. By degrees, our friendship grew stronger. by degreesୈʹʯ＝gradually degreeҐʯ friendship ʮ༑৘ʯ 456 457 Self Check"
    },
    {
        "id": "1276",
        "ja": "ぜひ，この件についてどう思うか教えてください。 by all means ʮͥͻͱ΋ʯ―means「手段」は単数形も複数形もmeans。 ⇧「 あ ら ゆ る（all）手 段（means）を 使 っ て（by）で も 」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ) (        ), please let us know what you think about the matter. By all means, please let us know what you think about the matter."
    },
    {
        "id": "1277",
        "ja": "ところで，あの本はもう読んだ？ ⇧「 道（the way）の そ ば（by） ⭢ （脇道にそれるが）ところで」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ) (        ), have you read that book yet? By the way, have you read that book yet? in the [one’s] wayʮʢ ʙ ͷ ʣअ ຐ ʹ ͳ ͬ ͯ ʯ ▼ 1278～1283ʪatʫ"
    },
    {
        "id": "1278",
        "ja": "ついに，戦争が終わった。",
        "en": "{At last, the war ended.}",
        "answer": "At last, the war ended.",
        "explanation": "▶ at は時や場所を点 （時点・地点） ととらえて「～に，～で」を意味する前置詞。\nat last ʮ͍ͭʹɼ΍ͬͱʯ＝/f_inally\n⇧「 最 後（last）で（at）」",
        "question": "(        ) (        ), the war ended."
    },
    {
        "id": "1279",
        "ja": "彼は趣味について長々と語った。 ⇧「 長 さ（length）を か け た 状 態 で（at）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "He (t      ) (        ) (        ) about his hobbies. He talked at length about his hobbies. at length  ᶃʮ ௕ ʑͱ ʯ ᶄʮ Α͏ ΍ ͘ɼ ΍ ͬͱʢ＝/f_inally ＝at lastʣʯ"
    },
    {
        "id": "1280",
        "ja": "最初は，彼らの英語についていけなかったが，次第に彼らが何を言っているのか 理解できるようになった。",
        "en": "{At /f_irst, I could not follow their English, but gradually I began to understand what they were saying. at /f_irstॳ͸ɼॳΊͷ͏ͪ͸ʯ⇦ 「最初の （first）時 点 に お い て は（at）」}",
        "answer": "At /f_irst, I could not follow their English, but gradually I began to understand what they were saying. at /f_irstॳ͸ɼॳΊͷ͏ͪ͸ʯ⇦ 「最初の （first）時 点 に お い て は（at）」",
        "explanation": "▶ 順序ではなく時点を表す。後にbut や however を 含 む 文 が き て ，「 し か し そ う\nではなかった」という内容が続く ことが多い。\n/f_irst of all ʮ·ͣॳΊʹɼୈҰʹʯ＝/f_irst ＝/f_irstly ― 順序を表す。➡1311-1\nfor the /f_irst time ʮॳΊͯʢʙ͢Δʣʯ\ngradually ʮঃʑʹʯ⇔⇔ suddenlyʮಥવʹʯ",
        "question": "(        ) (        ), I could not follow their English, but gradually I began to understand what they were saying."
    },
    {
        "id": "1281",
        "ja": "私はエッフェル塔を直接見てみたい。",
        "en": "I hope to see the Eiffel Tower /f_irst hand. (at) /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly ⇧ 「 （間接的ではなく） 直接最初に （first）手（hand）を 触 れ て（at）」 ⇔ (at) second hand઀తʹɼਓΛհͯ͠ʯ",
        "answer": "/f_irst hand. at /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly ⇧ 「 （間接的ではなく） 直接最初に （first）手（hand）を 触 れ て（at）」 ⇔ at second hand઀తʹɼਓΛհͯ͠ʯ",
        "explanation": "▶ Eiffel の発音に注意。/áif6l/\nclose at hand  ͘ʹʯᶅ ʮ΋͏͙͢ʯ➡1305-1",
        "question": "I hope to see the Eiffel Tower (        ) (h      )."
    },
    {
        "id": "1282",
        "ja": "その猫は気ままに行ったり来たりする。 ⇧「 自 由 な 意 志（will）で（at）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "The cat comes and goes (        ) (        ). The cat comes and goes at will. at will͍ͷ··ʹʯ"
    },
    {
        "id": "1283",
        "ja": "私たちは何としても戦争を避けなければならない。 ⇧「 す べ て の（all）／ ど ん な（any）犠 牲（costs/cost）で も（at）」 復習",
        "en": "{more / advance / person ▼ 1284～1286ʪonʫ}",
        "answer": "more / advance / person ▼ 1284～1286ʪonʫ",
        "explanation": "",
        "question": "We must avoid war (        ) (        ) (c      ). We must avoid war at all costs. at all costs at any cost    ਜ਼Λ෷ͬͯ΋ʯ avoid ʮʙΛආ͚Δʯ 458 459 Self Check"
    },
    {
        "id": "1284",
        "ja": "たぶん彼女はわざと会議に出席しなかったのだろう。",
        "en": "Perhaps she didn’t attend the meeting {on purpose.}",
        "answer": "on purpose.",
        "explanation": "▶ このon は前置詞で「～において」の意味を表す。\non purposeҙʹʯ＝intentionally ＝deliberately\n⇧「 目 的 や 意 図（purpose）に お い て（on）」\nperhaps ʮ΋͔͢͠Δͱʯ―probablyʮ͓ͦΒ͘ʯよ り確信度は低い。",
        "question": "Perhaps she didn’t attend the meeting (        ) (        )."
    },
    {
        "id": "1285",
        "ja": "発展 考え 直して，ピザを注文しようと思う。 ⇧「２回 め の（second）考 え（thought）に お い て（on）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ) (        ), I think I’ll order the pizza. On second thought(s), I think I’ll order the pizza. on second thought (s)͑௚ͯ͠ʯ"
    },
    {
        "id": "1286",
        "ja": "そのイベントは急きょ中止になった。",
        "en": "The event was canceled {on short notice. on [at] short notice͖ΐʯ ⇧「 短 い（short）通 知（notice）で（on/at）」}",
        "answer": "on short notice. on [at] short notice͖ΐʯ ⇧「 短 い（short）通 知（notice）で（on/at）」",
        "explanation": "▶ on short notice はアメリカで，at short notice はイギリスで使われる。\nbe canceledʹͳΔʯ\n▼ 1287～1296ʪinʫ",
        "question": "The event was canceled (        ) (        ) (n      )."
    },
    {
        "id": "1287",
        "ja": "実は，人前で話すのは好きではありません。緊張し てしまいます。",
        "en": "Actually, I don’t like speaking {in public. It makes me nervous.}",
        "answer": "in public. It makes me nervous.",
        "explanation": "▶ このin は前置詞で， 「～の中で」などの意味を表す。\nin publicવͱʯ⇦ 「公衆 （public）の 中 で（in）」\n⇔ in privateʮ಺ີʹʯ⇦ 「 プ ラ イ ベ ー ト（private）の 中 で（in）」\n“Can we talk about this in private?” “Yes, of course.”\n「この件について内密に話 せ ま す か 。」「 え え ， も ち ろ ん 。」",
        "question": "Actually, I don’t like speaking (        ) (        ). It makes me nervous."
    },
    {
        "id": "1288",
        "ja": "それをもっと詳しく説明していただけますか。 ⇧「 詳 細（detail）の 中 で（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Could you explain it (        ) (m      ) (        )? Could you explain it in more detail? in detail ʮৄ͘͠ʯ"
    },
    {
        "id": "1289",
        "ja": "もし来られるなら事前にご連絡ください。 ⇧「 前 進（advance）の 中 で（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Please let me know (        ) (        ) if you can come. Please let me know in advance if you can come. in advanceલʹɼ͋Β͔͡Ίʯ＝beforehand"
    },
    {
        "id": "1290",
        "ja": "各生徒が順番に質問に答えた。",
        "en": "Each student answered the question in turn. in turn  ౓͸ʯ",
        "answer": "in turn. in turn ౓͸ʯ",
        "explanation": "▶ このturn は名詞で「順番」の意味。",
        "question": "Each student answered the question (        ) (        )."
    },
    {
        "id": "1291",
        "ja": "彼女と直接話したい。 ⇧「 個 人（person）に お い て（in）」 復習",
        "en": "{in / case / opinion / view / some}",
        "answer": "in / case / opinion / view / some",
        "explanation": "",
        "question": "I prefer to talk to her (        ) (        ). I prefer to talk to her in person. in personΒʯ prefer to doΉʯ talk to A / talk with A ʮA ͱ࿩͢ʯ 460 461 Self Check"
    },
    {
        "id": "1292",
        "ja": "彼の言うことは，ある意味，本当だ。 ⇧「 あ る（a）意 味（sense）の 中 で は（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "What he says is true, (        ) (        ) (s      ). What he says is true, in a sense."
    },
    {
        "id": "1293",
        "ja": "サラは来なかったけど，とにかく私たちはとても楽しんだ。 ⇧「 ど の ような（any）場 合（case） ／割合 （rate）の 中 で も（in）／ に お い て も（at）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Sara didn’t come, but (i      ) (        ) (        ), we had a lot of fun. Sara didn’t come, but in any case, we had a lot of fun. in any case at any rate     ʮͱʹ͔͘ɼ͍ͣΕʹͤΑʯ ＝anyway have fun͠Ήʯ＝have a good time ＝enjoy oneself"
    },
    {
        "id": "1294",
        "ja": "万 一に備えてレシートは取っておいてください。 receipt ʮϨγʔτʯ―p は発音しない。",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Keep the receipt (        ) (        ) (        ). Keep the receipt just in case. just in case ʮສҰʹඋ͑ͯʯ in that caseʹ͸ʯ in case of A ʮAʹ͸ʯ in case …ʮ…ʹඋ͑ͯɼ…͢Δͱ͍͚ͳ͍͔Βʯ➡270"
    },
    {
        "id": "1295",
        "ja": "発展 ソーラーパネルの設置には費用がかかるが，長期的にはコスト削 減になる。 ⇧「 長 い（long）連 続（run）に お い て（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Installing solar panels can be expensive, but they reduce costs (        ) (        ) (        ) (        ). Installing solar panels can be expensive, but they reduce costs in the long run. in the long runతʹ͸ʯ ⇔ in the short runతʹ͸ʯ install ʮʙΛઃஔ͢Δʯ⇔⇔ removeʮʙΛऔΓ֎͢ʯ reduce costs͢Δʯ"
    },
    {
        "id": "1296",
        "ja": "私の考えでは，人種差別は教育によっ てなく すこ とができる。 ⇧「 ～ の 意 見（oneʼs opinion）に お い て（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ) (        ), racism can be eliminated through education. In my opinion, racism can be eliminated through education. racismʯ eliminate ʮʙΛऔΓআ͘ʯ＝remove ＝get rid of"
    },
    {
        "id": "1297",
        "ja": "森林保護は，生態系の観点から極めて重要だ。",
        "en": "Protecting forests is crucial {from an ecological point of view. from ～ point of view஍ʧ ͔Β͢Ε͹ʯ From the author ’s point of view, …ղʹΑΔͱ…ʯ crucialఆతͳʯ ecologicalͷʯ}",
        "answer": "from an ecological point of view. from ～ point of view஍ʧ ͔Β͢Ε͹ʯ From the author ’s point of view, …ղʹΑΔͱ…ʯ crucialఆతͳʯ ecologicalͷʯ",
        "explanation": "",
        "question": "Protecting forests is crucial (        ) an ecological (        ) (        ) (        )."
    },
    {
        "id": "1298",
        "ja": "ある程度，あなたのおっしゃることは理解できます。 ⇧「 あ る（some/a certain）程 度（extent/degree）ま で（to）」 復習",
        "en": "{to / at / close}",
        "answer": "to / at / close",
        "explanation": "",
        "question": "(        ) (        ) (        ), I understand what you’re saying. To some extent, I understand what you’re saying. to some extent [degree] 462 463 Self Check"
    },
    {
        "id": "1299",
        "ja": "驚いたことに，今夜は兄が私たちのために夕食を作ってくれた。",
        "en": "{To my surprise, my brother cooked dinner for us tonight.}",
        "answer": "To my surprise, my brother cooked dinner for us tonight.",
        "explanation": "▶ 〈to oneʼs＋感情を表す名詞〉 で， 「～が…したことに」という意味になる。\nto one’s surprise͍ͨ͜ͱʹʯ",
        "question": "(        ) (        ) (s      ), my brother cooked dinner for us tonight."
    },
    {
        "id": "1300",
        "ja": "うれしいことに，私の家族は新しい子犬を迎えることにした。",
        "en": "{To my delight, my family decided to adopt a new puppy. to one’s delightΜͩ͜ͱʹʯ adoptʹ͢Δʯ}",
        "answer": "To my delight, my family decided to adopt a new puppy. to one’s delightΜͩ͜ͱʹʯ adoptʹ͢Δʯ",
        "explanation": "",
        "question": "(        ) (        ) (d      ), my family decided to adopt a new puppy."
    },
    {
        "id": "1301",
        "ja": "私たちがほっとしたことに，妹は失くしたスマートフォンをベッドの下で見つけた。",
        "en": "{To our relief, my sister found her lost smartphone under the bed. to one’s reliefʮʙ͕҆৺ͨ͜͠ͱʹɼʙ͕΄ͬͱͨ͜͠ͱʹʯ}",
        "answer": "To our relief, my sister found her lost smartphone under the bed. to one’s reliefʮʙ͕҆৺ͨ͜͠ͱʹɼʙ͕΄ͬͱͨ͜͠ͱʹʯ",
        "explanation": "▶ much を付けると強調表現になる。Much to my relief「とても安心したことに」",
        "question": "(      ) (      ) (      ), my sister found her lost smartphone under the bed."
    },
    {
        "id": "1302",
        "ja": "テク ノロジーが私たちの仕事にどのような影響を与えるかは，誰も確かなことは 言えない。",
        "en": "No one can say for sure how technology will affect our jobs. for sure for certain    ͔ʹɼ͸͖ͬΓͱʯ＝surely ＝certainly to be sure͔ʹʢ…͕ͩʣʯ",
        "answer": "for sure how technology will affect our jobs. for sure for certain ͔ʹɼ͸͖ͬΓͱʯ＝surely ＝certainly to be sure͔ʹʢ…͕ͩʣʯ",
        "explanation": "",
        "question": "No one can say (f      ) (        ) how technology will affect our jobs."
    },
    {
        "id": "1303",
        "ja": "大学の授業料を自分で払わなければならないかもしれない。 ⇧「 ～ 自 身（oneʼs own）に お い て（on）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I may have to pay for my college tuition (        ) (        ) (        ). I may have to pay for my college tuition on my own. tuitionඅʯ"
    },
    {
        "id": "1304",
        "ja": "私はカードを１枚適当に選んだ。",
        "en": "I picked a card at random. 1305-1 英語を勉強する時，私はいつも辞書を手元に置いておく。 I always keep my dictionary (c      ) (        ) (        ) when I study English. 1305-1 I always keep my dictionary close at hand when I study English. close at hand near at hand    తʹʣ΋͏͙͢ʯ ⇧「 手（hand）の 近 く（close/near）に（at）」 (at) /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly  ➡1281 1305-2 すぐ近くにいいレストランがある。 There is a good restaurant (c      ) (        ) (        ). 1305-2 There is a good restaurant close at hand.",
        "answer": "at random. 1305-1 英語を勉強する時，私はいつも辞書を手元に置いておく。 I always keep my dictionary c      when I study English. 1305-1 I always keep my dictionary close at hand when I study English. close at hand near at hand తʹʣ΋͏͙͢ʯ ⇧「 手（hand）の 近 く（close/near）に（at）」 at /f_irst handʮ௚઀ɼ͔͡ʹʯ＝directly ➡1281 1305-2 すぐ近くにいいレストランがある。 There is a good restaurant c",
        "explanation": "▶ この問題文のclose at hand は「すぐ近くに」の意味。➡1305-1\nnearby͘ʹʯとほぼ同じ意味を表す。",
        "question": "I picked a card (        ) (        )."
    },
    {
        "id": "1306",
        "ja": "突然，大雨が降り始めた。",
        "en": "{All of a sudden, it began to rain heavily. all of a sudden ʮಥવɼ͍͖ͳΓʯ ＝suddenly ＝all at once}",
        "answer": "All of a sudden, it began to rain heavily. all of a sudden ʮಥવɼ͍͖ͳΓʯ ＝suddenly ＝all at once",
        "explanation": "",
        "question": "(A      ) (        ) (        ) (        ), it began to rain heavily."
    },
    {
        "id": "1307",
        "ja": "ホームステイ中，私の英語は少しずつ上達した。 ⇧「 少 し（little）の 差 で（by）ま た 少 し（little）」 復習",
        "en": "{to / example}",
        "answer": "to / example",
        "explanation": "",
        "question": "My English improved (        ) (        ) (        ) during the homestay. My English improved little by little during the homestay. little by little ʮগͣͭ͠ɼঃʑʹʯ＝gradually ＝by degrees one by one ʮ̍ͭͣͭʯ day by day ʮ೔ʹ೔ʹʯ 464 465 Self Check"
    },
    {
        "id": "1308",
        "ja": "発展 夕食は家族全員で食べることが 多い。",
        "en": "{More often than not, I eat dinner with the whole family. more often than not ʮ͍͍ͨͯʯ＝usually the whole family ʮՈ଒શһʯ}",
        "answer": "More often than not, I eat dinner with the whole family. more often than not ʮ͍͍ͨͯʯ＝usually the whole family ʮՈ଒શһʯ",
        "explanation": "",
        "question": "(M      ) (        ) (        ) (n      ), I eat dinner with the whole family."
    },
    {
        "id": "1309",
        "ja": "君はセーターを裏返しに着ているかもしれない。 ⇧「 内 側（inside）が 外（out）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "You might be wearing your sweater (        ) (        ). You might be wearing your sweater inside out. inside out ʮཪฦ͠ʹʯ"
    },
    {
        "id": "1310",
        "ja": "テーブルの 上にグラスが逆さまに置かれている。 ⇧「 上 側（upside） が下方向 （down）」 まず第一に，教育の重要性を強調したいと思います。 ⇧「 す べ て（all）の 中 の（of）最 初（first） 」―順序を表す。 at /f_irst ʮॳΊͷ͏ͪ͸ʯ― 時点を表す。➡1280 1311-2 初めに，この図をご覧ください。 ⇧「 ～ に つ い て（with）始 め る（begin/start）た め に（to）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "A glass is (u      ) (        ) on the table. A glass is upside down on the table. upside down͞·ʹʯ 1311-1 (F      ) (        ) (        ), I would like to emphasize the importance of education. 1311-1 First of all, I would like to emphasize the importance of education. /f_irst of all ʮ·ͣॳΊʹɼୈҰʹʯ＝/f_irst ＝/f_irstly ＝to begin with emphasizeௐ͢Δʯ (T      ) (        ) (        ), please take a look at this chart. 1311-2 To begin with, please take a look at this chart. to begin with to start with      ʮॳΊʹʯ＝/f_irst ＝/f_irstly ＝/f_irst of all"
    },
    {
        "id": "1312",
        "ja": "人々は環境を守るために対策を講じている。例えば，ごみを分別している。 for instance    ʮྫ͑͹ʯ⇦「 例（example） ／事例 （instance）とし て（for）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "People are taking steps to protect the environment. (        ) (        ), they separate their garbage. People are taking steps to protect the environment. For example, they separate their garbage. for example take steps͡Δʯ protect the environmentΛकΔʯ separate garbage ʮ͝ΈΛ෼ผ͢Δʯ"
    },
    {
        "id": "1313",
        "ja": "調査結果は次の通りです。 as followsͷ௨ΓɼҎԼͷ௨Γʯ⇦ 「 後 に 続 く（follows）よう に（as）」 ナオミは英語が流ちょうだ。加えて，フランス語も話せる。 ⇧ 「追加(addition) に お い て（in）」 私は英語以外の別の言語も学びたい。 ⇧「A に（to）加 え て（in addition）」 復習",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "The results of the survey are (        ) (f      ): The results of the survey are as follows: surveyʯ 1314-1 Naomi is fluent in English. (I      ) (        ), she can speak French. 1314-1 Naomi is fluent in English. In addition, she can speak French. in addition ʮՃ͑ͯʯ＝moreover ＝furthermore ＝what’s more be /f_luent in A ʮA ʣ͕ ྲྀͪΐ͏ͩʯ 1314-2 I would like to learn another language (i      ) (        ) (        ) (E      ). 1314-2 ＝ I would like to learn another language in addition to English. I would like to learn another language besides English. in addition to A ʮA ʹՃ͑ͯʯ＝besides A 466 467 Self Check"
    },
    {
        "id": "1314",
        "ja": "???",
        "en": "fact / practice / now",
        "answer": "???",
        "explanation": "",
        "question": "???"
    },
    {
        "id": "1315",
        "ja": "私は読書が好きだ。特に東野圭吾のミステリー小説を読むのが。 in particularʮಛʹʯ⇦ 「 特 定 の（particular）範 囲 内 で（in）」＝particularly",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I like reading, (i      ) (        ), mystery novels by Higashino Keigo. I like reading, in particular, mystery novels by Higashino Keigo. be particular about A ʮAΈͳͲ͕ʣ͏Δ͍͞ʯ➡898"
    },
    {
        "id": "1316",
        "ja": "何よりもまず，語学を学ぶには強い動機が必要だ。 above all ʮԿΑΓ΋·ͣɼͱΓΘ͚ʯ⇦「 す べ て（all）よ りも 上 に（above）」 実は，これら 2 つのことはまったく異なります。 in truth    ͸ʯ⇦「事実 （fact）の 中（in）で は 」＝actually 1317-2 実のところ，君の意見には賛成できない。 ⇧「 事 実（fact）の（of）事 柄（a matter）とし て は（as）」 1317-3 実際には，プラ スチックの使用を完全に避けることは難しいだろう。 ⇧「 実 行（practice） ／現実(reality) に お い て は（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(A      ) (        ), learning a language requires a strong motivation. Above all, learning a language requires a strong motivation. require͢Δʯ 1317-1 (        ) (f      ), these two things are very different. 1317-1 In fact, these two things are very different. in fact The fact is (that) …͸…ͩʯ➡231 (A      ) (        ) (        ) (        ) (        ), I don’t agree with you. 1317-2 As a matter of fact, I don’t agree with you. as a matter of fact͏ͱʯ (        ) (p      ), it would be difficult to avoid using plastic completely. 1317-3 In practice, it would be difficult to avoid using plastic completely. in practice in reality        ʹ͸ʯ"
    },
    {
        "id": "1318",
        "ja": "日本は経済的に豊かな国だが，それでも，十分に食べられない子どもたちがいる。",
        "en": "Japan is an economically rich country, but {even now, some children do not have enough to eat.}",
        "answer": "even now, some children do not have enough to eat.",
        "explanation": "▶ even now は後に否定文が続く ことが多い。この問題文ではeven so でも正解。\neven so ʮͦ͏ͩͱͯ͠΋ʯ＝still ＝nevertheless ＝nonetheless",
        "question": "Japan is an economically rich country, but (        ) (        ), some children do not have enough to eat."
    },
    {
        "id": "1319",
        "ja": "日本人の寿命は伸びてきている。その一方で，出生率は低下している。 ⇧ 「２つの手にあるうちの，も う一方の （the other）手（hand）に お い て（on）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Life expectancy in Japan has increased. (O      ) (        ) (        ) (        ), the birth rate is declining. Life expectancy in Japan has increased. On the other hand, the birth rate is declining."
    },
    {
        "id": "1320",
        "ja": "外 は 寒くない 。それどころか，かなり暖かい。",
        "en": "It’s not cold outside. {On the contrary, it’s quite warm. on the contrary ʮͦΕͲ͜Ζ͔ɼΉ͠Ζʯ ⇧「 前 に 述 べ た こととは 逆（the contrary）に お い て（on）」}",
        "answer": "On the contrary, it’s quite warm. on the contrary ʮͦΕͲ͜Ζ͔ɼΉ͠Ζʯ ⇧「 前 に 述 べ た こととは 逆（the contrary）に お い て（on）」",
        "explanation": "▶ on the contrary は前文の内容を否定する表現。文頭に置く ことが多い。\nto the contraryʹʧ ʯ―文中や文末で使うことが多い。",
        "question": "It’s not cold outside. (O      ) (        ) (        ), it’s quite warm."
    },
    {
        "id": "1321",
        "ja": "太陽光発電はク リーンだ。これ に対して，火力発電は汚染を引き起こす。 ⇧「 対 照（contrast）に お い て（in） 」 「対照 （contrast）す る こ と に よっ て（by）」 復習",
        "en": "{that / short}",
        "answer": "that / short",
        "explanation": "",
        "question": "Solar power is clean. (        ) (        ), thermal power generation causes pollution. Solar power is clean. In contrast, thermal power generation causes pollution. in contrast ＝by contrastʮ͜Εʹରͯ͠ɼͦΕʹൺ΂ͯʯ in contrast to A ʮA ͱ͸ରরతʹʯ thermal power generation ʮՐྗൃిʯ―thermalʮ೤ͷɼԹ౓ͷʯ pollution ʮԚછʯ 468 469 Self Check"
    },
    {
        "id": "1322",
        "ja": "人類は温室効果ガスを排出し続け，その結果，私たちは地球温暖化に直面し ている。",
        "en": "Humans continue to emit greenhouse gases, and {as a result, we are facing global warming. as a resultՌͱ͠ ͯʯ＝consequently ＝as a consequence emit greenhouse gasesՌΨεΛഉग़͢Δʯ face A೉ͳͲʣʹ௚໘͢Δʯ＝be faced with A ＝be confronted with A}",
        "answer": "as a result, we are facing global warming. as a resultՌͱ͠ ͯʯ＝consequently ＝as a consequence emit greenhouse gasesՌΨεΛഉग़͢Δʯ face A೉ͳͲʣʹ௚໘͢Δʯ＝be faced with A ＝be confronted with A",
        "explanation": "",
        "question": "Humans continue to emit greenhouse gases, and (       ) (       ) (r     ), we are facing global warming."
    },
    {
        "id": "1323",
        "ja": "結局，そのイベントには行かないことにした。 ⇧「 す べ て（all）終 わ っ た 後（after）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "I decided not to go to that event (        ) (        ). I decided not to go to that event after all. after all͸ʯ＝eventually decide not to do ʮʙ͠ͳ͍͜ͱʹ͢Δʯ"
    },
    {
        "id": "1324",
        "ja": "最終的にはすべてうまくいった。",
        "en": "It all worked out {in the end. in the endऴతʹʯ⇦「最後 （the end）の 中 に お い て（in）」 ＝eventually}",
        "answer": "in the end. in the endऴతʹʯ⇦「最後 （the end）の 中 に お い て（in）」 ＝eventually",
        "explanation": "▶ 主語It all のit は「状況」を表すit。all が続いて「状況全体」を表している。",
        "question": "It all worked out (        ) (        ) (        )."
    },
    {
        "id": "1325",
        "ja": "太陽エネルギーは持続可能だ。言いかえれば，決して尽きることはない。 ⇧「 他 の（other）言 葉（words）に お い て（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Solar energy is sustainable. (       ) (       ) (       ), it will never run out. Solar energy is sustainable. In other words, it will never run out. in other words͍͔͑Ε͹ʯ sustainableଓՄೳͳʯ"
    },
    {
        "id": "1326",
        "ja": "汚染は至る所で深刻だ。別の言い方をすれば，地球は病気になりつつある。 ⇧ 「今述べたこと （it）を 別 の や り 方 で（another way）言 葉 と し て 置 く（put）と 」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Pollution is severe everywhere. (        ) (        ) (        ) (        ) (w     ), the Earth is getting sick. Pollution is severe everywhere. To put it another way, the Earth is getting sick. to put it another way͍ํΛ͢Δͱʯ severeͳʯ＝very serious"
    },
    {
        "id": "1327",
        "ja": "他の子どもたちと同じ機会を得られない子どもたちもいる。つまり，貧困は子どもの 教育に影響を与える。 ⇧「 そ れ は（that is）言うなら ば（to say）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "Some children do not have the same opportunities as others. (        ) (        ) (        ) (        ), poverty affects children’s education. Some children do not have the same opportunities as others. That is to say, poverty affects children’s education. that is (to say)ʮͭ·Γɼ͢ͳΘͪʯ＝namely aﬀect AʮA͢Δʯ＝in/f_luence A ＝have an eﬀect on A"
    },
    {
        "id": "1328",
        "ja": "要するに，日本は出生率の低下と平均寿命の伸びにより急速に高齢化し ている。 in brief     ͑͹ʯ⇦「 短 い（short/brief）中 で（in）」",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(        ) (        ), Japan is aging rapidly due to its low birth rate and long average life expectancy. In short, Japan is aging rapidly due to its low birth rate and long average life expectancy. in short in a word͑͹ʯ rapidly଎ʹʯ⇔⇔ slowlyʮΏͬ͘Γʯ average life expectancyण໋ʯ"
    },
    {
        "id": "1329",
        "ja": "結 論として，スマートフォンは私たちの日常生活になくてはならないものとなっている。 復習",
        "en": "???",
        "answer": "???",
        "explanation": "",
        "question": "(I      ) (c      ), smartphones have become an indispensable part of our daily lives. In conclusion, smartphones have become an indispensable part of our daily lives. in conclusion࿦ͱ͠ ͯʯ＝to conclude indispensableͳɼͳͯ͘͸ͳΒͳ͍ʯ＝essential (our) daily livesʯ 470 471 Self Check"
    }
];

        // --- App State ---
        let activeSentenceElement = null;
        let selectedSentences = new Set();
        let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
        }
        
        // --- Voice Synthesis Setup ---
        let synthesisVoice = null;

        function setSynthesisVoice() {
            const voices = speechSynthesis.getVoices();
            // 優先順位: Google US English -> Microsoft Zira/David -> その他英語
            synthesisVoice = voices.find(voice => voice.name === 'Google US English') ||
                             voices.find(voice => voice.name.includes('Google') && voice.lang.includes('en-US')) ||
                             voices.find(voice => voice.name.includes('Microsoft') && voice.lang.includes('en-US')) ||
                             voices.find(voice => voice.lang === 'en-US') ||
                             voices.find(voice => voice.lang.startsWith('en'));
        }

        // 音声リストがロードされたら設定を実行
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = setSynthesisVoice;
        }
        // 初期化時にも実行
        setSynthesisVoice();


        // --- DOM Elements ---
        const sentenceList = document.getElementById('sentence-list');
        const toggleAnswerBtn = document.getElementById('toggle-answer-btn');
        const playSoundBtn = document.getElementById('play-sound-btn');
        const recordBtn = document.getElementById('record-btn');
        const toggleExplanationBtn = document.getElementById('toggle-explanation-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const messageModal = document.getElementById('message-modal');
        const messageContent = document.getElementById('message-content');
        const quizModal = document.getElementById('quiz-modal');
        const closeQuizBtn = document.getElementById('close-quiz-btn');
        const quizContent = document.getElementById('quiz-content');
        
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const pdfModal = document.getElementById('pdf-modal');
        const openPdfModalBtn = document.getElementById('open-pdf-modal-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');


        // --- Functions ---

        /**
         * Parses the English sentence template and creates the HTML structure.
         */
        function formatEnglishSentence(enTemplate, answer) {
            const blank = '__________';
            const answerHtml = `<span class="answer-span">${answer}</span>`;
            const underlineHtml = `<span class="underline-span">${blank}</span>`;
            const formattedSentence = enTemplate.replace(`{${answer}}`, `${answerHtml}${underlineHtml}`);
            return formattedSentence;
        }

        /**
         * Renders all sentences for the chapter.
         */
        function renderChapter() {
            sentenceList.innerHTML = '';
            chapterData.forEach(item => {
                const sentenceDiv = document.createElement('div');
                sentenceDiv.className = 'sentence-item p-4 border border-gray-200 rounded-lg bg-white transition-shadow duration-300 hover:shadow-md cursor-pointer';
                sentenceDiv.dataset.id = item.id;
                sentenceDiv.dataset.fullSentence = item.en.replace(`{${item.answer}}`, item.answer);

                const englishSentenceHtml = formatEnglishSentence(item.en, item.answer);

                sentenceDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                         <div class="flex items-center pt-1" onclick="event.stopPropagation()">
                            <input type="checkbox" class="sentence-checkbox h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500" data-id="${item.id}">
                        </div>
                        <span class="text-lg font-bold text-gray-500 w-10 shrink-0 pt-1">${item.id}</span>
                        <div class="flex-1">
                            <p class="mb-2 text-gray-700">${item.ja}</p>
                            <p class="font-english">${englishSentenceHtml}</p>
                            <div class="explanation mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-400 text-gray-700 rounded-r-lg">
                                ${item.explanation}
                            </div>
                        </div>
                    </div>
                `;
                sentenceList.appendChild(sentenceDiv);
            });
            
            // Add click listener to each sentence item
            document.querySelectorAll('.sentence-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    // Don't select if clicking inside explanation
                    if (e.target.closest('.explanation')) return;
                    if (e.target.closest('.sentence-checkbox')) return; // Checkbox click is handled separately

                    if (activeSentenceElement) {
                        activeSentenceElement.classList.remove('ring-2', 'ring-blue-400', 'shadow-xl');
                    }
                    activeSentenceElement = item;
                    activeSentenceElement.classList.add('ring-2', 'ring-blue-400', 'shadow-xl');
                });
            });

            // Checkbox logic
            document.querySelectorAll('.sentence-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const id = e.target.dataset.id;
                    if (e.target.checked) {
                        selectedSentences.add(id);
                    } else {
                        selectedSentences.delete(id);
                    }
                });
            });
            
            // Select the first sentence by default
            if (sentenceList.firstChild) {
                 sentenceList.firstChild.click();
            }
        }
        
        // --- PDF / Print Logic ---
        
        function openPrintWindow(bodyContent, title) {
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="ja">
                <head>
                    <meta charset="UTF-8">
                    <title>Insight App - Chapter 26</title>
                    <style>
                        body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; line-height: 1.8; margin: 25px; color: #333; }
                        @media print { .no-print { display: none; } }
                        h1, h2 { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 25px; }
                        ol, ul { list-style-position: inside; padding-left: 0; }
                        li { margin-bottom: 15px; }
                        .list-container { 
                            column-count: 2; 
                            column-gap: 40px; 
                        }
                        .list-container li, .list-container p { 
                            -webkit-column-break-inside: avoid; 
                            page-break-inside: avoid; 
                            break-inside: avoid; 
                        }
                        ol li {
                            list-style-type: decimal;
                            margin-left: 1.5em; 
                        }
                        .inline-content {
                            display: inline;
                        }
                        @media (max-width: 700px) { .list-container { column-count: 1; } }
                        .answer-key { page-break-before: always; margin-top: 50px; }
                        u { text-decoration: underline; text-underline-offset: 3px; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <p class="no-print" style="text-align:center; margin-bottom: 20px; font-size: 0.9em; color: #666;">
                        ※印刷ダイアログが表示されない場合は、Ctrl+P (または Cmd+P) を押してください。
                    </p>
                    ${bodyContent}
                </body>
                </html>
            `;
            const printWindow = window.open('', '_blank');
            if (!printWindow) {
                showMessage('<p>ポップアップがブロックされました。設定を確認してください。</p>', 5000);
                return;
            }
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.focus(); 
                printWindow.print();
            }, 250);
        }

        function getSelectedItems() {
            if (selectedSentences.size === 0) {
                showMessage('<p>PDFを作成する問題を選択してください。</p>', 3000);
                return null;
            }
            // Sort items based on ID
            return Array.from(selectedSentences)
                .map(id => chapterData.find(item => item.id === id))
                .filter(Boolean)
                .sort((a, b) => {
                     // Handle IDs like "1382-1" vs "1382-2"
                     const aParts = a.id.split('-').map(s => parseInt(s) || 0);
                     const bParts = b.id.split('-').map(s => parseInt(s) || 0);
                     if (aParts[0] !== bParts[0]) return aParts[0] - bParts[0];
                     return (aParts[1] || 0) - (bParts[1] || 0);
                });
        }
        
        function getUniqueItems(items) {
             const uniqueMap = new Map();
             items.forEach(item => {
                 // Use answer as key to deduplicate same phrases
                 if (!uniqueMap.has(item.answer)) {
                     uniqueMap.set(item.answer, item);
                 }
             });
             return Array.from(uniqueMap.values()).sort((a, b) => {
                 const aId = parseInt(a.id.split('-')[0]);
                 const bId = parseInt(b.id.split('-')[0]);
                 return aId - bId;
             });
        }


        // --- Message & Sound Functions ---
        
        function showMessage(htmlContent, duration = null) {
            messageContent.innerHTML = htmlContent;
            messageModal.classList.remove('hidden');
            if (duration) {
                setTimeout(() => {
                    messageModal.classList.add('hidden');
                }, duration);
            }
        }

        function playSound() {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }

            // 音声が未設定なら再取得を試みる
            if (!synthesisVoice) {
                setSynthesisVoice();
            }

            // 連続再生を防ぐために一度キャンセル
            speechSynthesis.cancel();
            
            let textToSpeak = activeSentenceElement.dataset.fullSentence;
            // 念のため不要な記号を除去
            textToSpeak = textToSpeak.replace(/[{}]/g, '');

            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'en-US';

            // 英語音声が取得できていれば設定
            if (synthesisVoice) {
                utterance.voice = synthesisVoice;
            }

            utterance.rate = 1.0; 
            utterance.pitch = 1.0;

            speechSynthesis.speak(utterance);
        }

        function handleRecording() {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            if (!SpeechRecognition) {
                showMessage('<p>お使いのブラウザは音声認識に対応していません。</p>', 3000);
                return;
            }

            showMessage('<p class="text-2xl">マイクに向かって話してください...</p><div class="animate-pulse text-red-500 text-4xl mt-4">●</div>');
            
            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                evaluatePronunciation(transcript);
            };

            recognition.onerror = (event) => {
                showMessage(`<p>エラーが発生しました: ${event.error}</p>`, 3000);
            };
            
            recognition.onend = () => {
                 if (messageModal.classList.contains('hidden') === false && messageContent.innerHTML.includes('マイクに')) {
                    messageModal.classList.add('hidden');
                 }
            };
        }
        
        function evaluatePronunciation(transcript) {
            const originalText = activeSentenceElement.dataset.fullSentence;

            const cleanOrig = originalText.toLowerCase().replace(/[^\w\s]/g, '').split(' ');
            const cleanTrans = transcript.toLowerCase().replace(/[^\w\s]/g, '').split(' ');
            
            let matches = 0;
            cleanOrig.forEach(word => {
                if (cleanTrans.includes(word)) {
                    matches++;
                }
            });

            const similarity = matches / cleanOrig.length;
            
            let score;
            if (similarity > 0.9) {
                score = 95 + Math.floor(Math.random() * 5);
            } else if (similarity > 0.7) {
                score = 90 + Math.floor(Math.random() * 6);
            } else if (similarity > 0.5) {
                score = 85 + Math.floor(Math.random() * 5);
            } else if (similarity > 0.3) {
                score = 80 + Math.floor(Math.random() * 5);
            } else {
                score = 70 + Math.floor(Math.random() * 10);
            }
            
            if (score === 100 && Math.random() < 0.3) score = 99;

            const messageHtml = `
                <h3 class="text-2xl font-bold mb-4">評価結果</h3>
                <p class="text-7xl font-bold text-blue-600 mb-4">${score}<span class="text-2xl">点</span></p>
                <p class="text-gray-600 mb-2"><strong>あなたの発音:</strong> ${transcript}</p>
                <p class="text-gray-600"><strong>元の文:</strong> ${originalText}</p>
                <button onclick="document.getElementById('message-modal').classList.add('hidden')" class="mt-6 bg-blue-500 text-white py-2 px-6 rounded-lg">閉じる</button>
            `;
            showMessage(messageHtml);
        }

        // --- Quiz Functions ---

        function startQuiz() {
            if (chapterData.length < 10) {
                 showMessage('<p>クイズを作成するには、文が10個以上必要です。</p>', 3000);
                 return;
            }

            const shuffled = [...chapterData].sort(() => 0.5 - Math.random());
            const questions = shuffled.slice(0, 10);

            let currentQuestionIndex = 0;
            let score = 0;

            function showQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    showQuizResult();
                    return;
                }

                const question = questions[currentQuestionIndex];
                const correctAnswer = question.answer;

                const incorrectAnswers = chapterData
                    .filter(item => item.answer !== correctAnswer)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(item => item.answer);

                const options = [correctAnswer, ...incorrectAnswers].sort(() => 0.5 - Math.random());
                
                const questionSentence = question.en.replace(`{${question.answer}}`, ' (______) ');

                quizContent.innerHTML = `
                    <h3 class="text-2xl font-bold mb-2">問題 ${currentQuestionIndex + 1}/10</h3>
                    <p class="text-lg mb-4">${question.ja}</p>
                    <p class="font-english text-xl mb-6 p-4 bg-gray-100 rounded-lg">${questionSentence}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${options.map(opt => `<button class="quiz-option p-4 bg-blue-100 hover:bg-blue-200 rounded-lg text-left text-lg font-english" data-answer="${opt}">${opt}</button>`).join('')}
                    </div>
                `;

                document.querySelectorAll('.quiz-option').forEach(button => {
                    button.addEventListener('click', () => {
                        if (button.dataset.answer === correctAnswer) {
                            score++;
                            button.classList.add('bg-green-400', 'text-white');
                        } else {
                            button.classList.add('bg-red-400', 'text-white');
                            document.querySelector(`.quiz-option[data-answer="${CSS.escape(correctAnswer)}"]`).classList.add('bg-green-400', 'text-white');
                        }
                        
                        setTimeout(() => {
                            currentQuestionIndex++;
                            showQuestion();
                        }, 1200);
                    });
                });
            }

            function showQuizResult() {
                quizContent.innerHTML = `
                    <h3 class="text-3xl font-bold mb-4 text-center">テスト終了！</h3>
                    <p class="text-center text-xl mb-6">あなたのスコアは...</p>
                    <p class="text-center text-7xl font-bold text-purple-600">${score * 10}<span class="text-3xl">点</span></p>
                    <p class="text-center text-xl mt-2">(${questions.length}問中 ${score}問正解)</p>
                `;
            }

            showQuestion();
            quizModal.classList.remove('hidden');
        }


        // --- Event Listeners ---

        toggleAnswerBtn.addEventListener('click', () => {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            activeSentenceElement.classList.toggle('show-answer');
        });

        toggleExplanationBtn.addEventListener('click', () => {
            if (!activeSentenceElement) {
                showMessage('<p>文を選択してください。</p>', 2000);
                return;
            }
            const explanationDiv = activeSentenceElement.querySelector('.explanation');
            if (explanationDiv.style.display === 'block') {
                explanationDiv.style.display = 'none';
            } else {
                explanationDiv.style.display = 'block';
            }
        });
        
        playSoundBtn.addEventListener('click', playSound);
        recordBtn.addEventListener('click', handleRecording);
        startQuizBtn.addEventListener('click', startQuiz);
        closeQuizBtn.addEventListener('click', () => quizModal.classList.add('hidden'));
        
        // Select All Logic
        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const checkboxes = document.querySelectorAll('.sentence-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = isChecked;
                if (isChecked) selectedSentences.add(cb.dataset.id);
                else selectedSentences.delete(cb.dataset.id);
            });
        });

        // PDF Modal Logic
        openPdfModalBtn.addEventListener('click', () => {
             if (selectedSentences.size === 0) {
                showMessage('<p>PDFを作成する問題を選択してください。</p>', 3000);
                return;
            }
            pdfModal.classList.remove('hidden');
        });
        closeModalBtn.addEventListener('click', () => pdfModal.classList.add('hidden'));

        // --- PDF Generation Buttons Listeners ---

        // 変更: PDF内のサブタイトルを「Insight 英文法・語法・熟語 ＋ 章とその題」の形式にする
        // h1: "Insight 英文法・語法・熟語"
        // h2: "学習用サイト（28章 その他の重要熟語）" -> "（28章 その他の重要熟語）" の部分を抽出して結合
        const mainTitle = document.querySelector('header h1').innerText;
        const subTitleRaw = document.getElementById('app-subtitle').innerText;
        // "学習用サイト" という文字が含まれていれば削除して整形
        const chapterTitle = subTitleRaw.replace('学習用サイト', '').trim();
        const subtitleText = `${mainTitle} ${chapterTitle}`;

        // 1. 完全なリスト
        document.getElementById('download-list-btn').addEventListener('click', () => {
            const items = getSelectedItems();
            if(!items) return;
            // リスト作成の場合は重複があっても良いが、見やすくするために熟語ベースでユニークにするか、
            // そのままID順で並べるか。ここではID順ですべて表示する。
            
            const listItems = items.map(item => {
                // Remove { } for clean display
                const cleanEn = item.en.replace(/[{}]/g, '');
                return `<li>
                    <span class="inline-content"><strong>${item.answer}</strong>: ${item.explanation.replace(/\n/g, '<br>')}</span><br>
                    <span style="font-size:0.9em; color:#555;">Ex: ${cleanEn} / ${item.ja}</span>
                </li>`;
            }).join('');
            
            openPrintWindow(`<ul class="list-container">${listItems}</ul>`, '重要熟語リスト');
            pdfModal.classList.add('hidden');
        });

        // 2. 英語を解答
        document.getElementById('download-en-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            
            const quizItems = items.map(item => 
                `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')} : ____________________</span></li>`
            ).join('');
            const answerItems = items.map(item => 
                `<li><span class="inline-content">${item.answer}</span></li>`
            ).join('');
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (英語を解答)');
            pdfModal.classList.add('hidden');
        });

        // 3. 意味を解答
        document.getElementById('download-ja-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            
            const quizItems = items.map(item => 
                `<li><span class="inline-content"><strong>${item.answer}</strong> : ____________________</span></li>`
            ).join('');
            const answerItems = items.map(item => 
                `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')}</span></li>`
            ).join('');
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (意味を解答)');
            pdfModal.classList.add('hidden');
        });

        // 4. 混合
        document.getElementById('download-mixed-quiz-btn').addEventListener('click', () => {
            const items = getUniqueItems(getSelectedItems());
            let quizItems = '';
            let answerItems = '';
            
            items.forEach(item => {
                if (Math.random() > 0.5) {
                    // 日本語 -> 英語
                    quizItems += `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')} : ____________________</span></li>`;
                    answerItems += `<li><span class="inline-content">${item.answer}</span></li>`;
                } else {
                    // 英語 -> 日本語
                    quizItems += `<li><span class="inline-content"><strong>${item.answer}</strong> : ____________________</span></li>`;
                    answerItems += `<li><span class="inline-content">${item.explanation.replace(/\n/g, ' ')}</span></li>`;
                }
            });
            
            const body = `<h2>${subtitleText}</h2><ol class="list-container">${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (混合)');
            pdfModal.classList.add('hidden');
        });

        // 5. 例文穴埋め
        document.getElementById('download-sentence-quiz-btn').addEventListener('click', () => {
            const items = getSelectedItems(); // 例文問題なので重複（文脈違い）も含める
            
            const quizItems = items.map(item => {
                // Replace {answer} with underscore
                const blankSentence = item.en.replace(`{${item.answer}}`, '____________________');
                return `<li>${blankSentence}<br><span style="font-size:0.9em;">(${item.ja})</span></li>`;
            }).join('');
            
            const answerItems = items.map(item => 
                `<li>${item.answer}</li>`
            ).join('');

            const body = `<h2>${subtitleText}</h2><ol>${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (例文穴埋め)');
            pdfModal.classList.add('hidden');
        });

        // 6. 例文混合 (穴埋め / 下線部和訳)
        document.getElementById('download-sentence-mixed-quiz-btn').addEventListener('click', () => {
            const items = getSelectedItems();
            let quizItems = '';
            let answerItems = '';
            
            const instruction = '<p style="border:1px solid #ccc; padding:10px; margin-bottom:20px;">指示：空所には適切な語句を補い、下線部がある文は下線部の意味を日本語で答えなさい。</p>';

            items.forEach(item => {
                if (Math.random() > 0.5) {
                    // 穴埋め
                    const blankSentence = item.en.replace(`{${item.answer}}`, '____________________');
                    quizItems += `<li>${blankSentence}<br><span style="font-size:0.9em;">(${item.ja})</span></li>`;
                    answerItems += `<li>${item.answer}</li>`;
                } else {
                    // 下線部和訳 (ここでは熟語の意味を問う形にする)
                    const underlineSentence = item.en.replace(`{${item.answer}}`, `<u>${item.answer}</u>`);
                    quizItems += `<li>${underlineSentence}<br>意味: ____________________</li>`;
                    answerItems += `<li>${item.explanation.split('\n')[0]}</li>`; // 解説の1行目を答えとする
                }
            });

            const body = `<h2>${subtitleText}</h2>${instruction}<ol>${quizItems}</ol><div class="answer-key"><h2>解答</h2><ol class="list-container">${answerItems}</ol></div>`;
            openPrintWindow(body, '熟語テスト (例文混合)');
            pdfModal.classList.add('hidden');
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            renderChapter();
        });
    </script>
</body>
</html>